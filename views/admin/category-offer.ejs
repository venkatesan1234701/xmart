<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Category Offer Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="../assets/css/theme.min.css">
<!-- 
  <style>
    /* -------------------------------
   GLOBAL STYLING
--------------------------------*/
body {
  font-family: "Inter", sans-serif;
  background: #f8fafc;
  margin: 0;
  padding: 0;
  color: #1e293b;
}

h2 {
  font-weight: 700;
  color: #0f172a;
}

/* -------------------------------
   TOP NAVBAR
--------------------------------*/
nav.w-full {
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  background: white;
}

nav ul li a {
  font-weight: 500;
  transition: 0.25s;
}

nav ul li a:hover {
  color: #16a34a !important;
}

.main-content-wrapper {
  margin-top: 100px !important;
}

/* -------------------------------
   SEARCH BAR
--------------------------------*/
#category-search {
  border-radius: 8px;
  padding: 7px 12px;
  border: 1px solid #cbd5e1;
  transition: 0.25s ease;
}

#category-search:focus {
  border-color: #22c55e;
  box-shadow: 0 0 0 3px rgba(34,197,94,0.25);
}

/* Search Button */
button[type="submit"] {
  border-radius: 8px;
}

/* -------------------------------
   ADD OFFER BUTTON
--------------------------------*/
#openModalBtn {
  background: linear-gradient(135deg, #16a34a, #22c55e);
  box-shadow: 0 2px 8px rgba(34,197,94,0.3);
  padding: 10px 20px;
  border-radius: 10px;
  border: none;
  transition: 0.3s;
}

#openModalBtn:hover {
  background: linear-gradient(135deg, #15803d, #16a34a);
  transform: translateY(-2px);
}

/* -------------------------------
   TABLE DESIGN
--------------------------------*/
.table-responsive {
  border-radius: 12px;
  overflow: hidden;
}

table {
  background: white;
}

table thead {
  background: #f1f5f9;
}

table thead th {
  font-weight: 600;
  padding: 14px;
  font-size: 14px;
}

table tbody td {
  padding: 12px;
  font-size: 14px;
}

table tbody tr {
  transition: 0.2s ease;
}

table tbody tr:hover {
  background: #f8fafc;
}

/* -------------------------------
   ACTION BUTTONS (EDIT / DELETE)
--------------------------------*/
.btn-primary.btn-sm {
  background: linear-gradient(135deg, #1976d2, #1565c0);
  border: none;
  border-radius: 8px;
  padding: 6px 14px;
  color: white;
  font-weight: 500;
  transition: 0.25s ease;
}

.btn-primary.btn-sm:hover {
  background: linear-gradient(135deg, #2196f3, #0d47a1);
  transform: translateY(-2px);
}

.btn-danger.btn-sm {
  background: linear-gradient(135deg, #e53935, #d32f2f);
  border: none;
  border-radius: 8px;
  padding: 6px 14px;
  color: white;
  font-weight: 500;
  transition: 0.25s ease;
}

@media (max-width: 640px) {
  aside {
    transform: translateX(-100%);
    transition: 0.3s;
  }

  aside.open {
    transform: translateX(0);
  }

  main {
    margin-left: 0 !important;
    width: 100% !important;
  }
}

.btn-danger.btn-sm:hover {
  background: linear-gradient(135deg, #f44336, #c62828);
  transform: translateY(-2px);
}

/* -------------------------------
   BADGES
--------------------------------*/
.badge.bg-success {
  background: #16a34a !important;
}

.badge.bg-danger {
  background: #dc2626 !important;
}

.badge.bg-warning {
  background: #f59e0b !important;
  color: #1f2937 !important;
}

/* -------------------------------
   MODAL STYLE
--------------------------------*/
.modal-content {
  border-radius: 12px !important;
  padding: 20px;
  border: none;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
}

.modal-title {
  font-weight: 700;
  color: #0f172a;
}

/* Modal Inputs */
.modal-body input,
.modal-body select {
  border-radius: 10px !important;
  border: 1px solid #cbd5e1 !important;
  padding: 10px !important;
  transition: 0.2s ease;
}

.modal-body input:focus,
.modal-body select:focus {
  border-color: #22c55e !important;
  box-shadow: 0 0 0 3px rgba(34,197,94,0.25);
}

/* Modal Buttons */
.modal-body .btn-success {
  background: #16a34a !important;
  border-radius: 8px;
  padding: 8px 18px;
}

.modal-body .btn-success:hover {
  background: #15803d !important;
}

.modal-body .btn-secondary {
  border-radius: 8px;
  padding: 8px 18px;
}

/* -------------------------------
   PAGINATION
--------------------------------*/
.pagination .page-link {
  border-radius: 8px;
  margin: 0 3px;
  border: 1px solid #cbd5e1;
  color: #1e293b;
  transition: 0.2s ease;
}

.pagination .page-link:hover {
  background: #e2e8f0;
}

.pagination .active .page-link {
  background: #16a34a !important;
  border-color: #16a34a !important;
  color: white !important;
}

/* -------------------------------
   ANIMATIONS
--------------------------------*/
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.modal-content {
  animation: fadeIn 0.3s ease;
}

  </style> -->


  <style>
    /* ===============================
   GLOBAL
================================ */
body {
  font-family: "Inter", sans-serif;
  background: #f8fafc;
  margin: 0;
  padding: 0;
  color: #1e293b;
}

h2 {
  font-weight: 700;
  color: #0f172a;
}

/* ===============================
   NAVBAR
================================ */
nav.w-full {
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  background: white;
}

.main-content-wrapper {
  margin-top: 100px !important;
}

/* ===============================
   SEARCH BAR
================================ */
#category-search {
  border-radius: 8px;
  padding: 7px 12px;
  border: 1px solid #cbd5e1;
  transition: 0.25s ease;
}

#category-search:focus {
  border-color: #22c55e;
  box-shadow: 0 0 0 3px rgba(34,197,94,0.25);
}

/* ===============================
   ADD OFFER BUTTON
================================ */
#openModalBtn {
  background: linear-gradient(135deg, #16a34a, #22c55e);
  box-shadow: 0 2px 8px rgba(34,197,94,0.3);
  padding: 10px 20px;
  border-radius: 10px;
  border: none;
  transition: 0.3s;
}

#openModalBtn:hover {
  background: linear-gradient(135deg, #15803d, #16a34a);
  transform: translateY(-2px);
}

/* ===============================
   TABLE RESPONSIVE (IMPORTANT)
================================ */

/* Horizontal scroll ONLY for table */
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border-radius: 12px;
}

/* Table base */
.table-responsive table {
  background: #fff;
  width: 100%;
  min-width: 900px;
  border-collapse: collapse;
}

/* Tablet */
@media (max-width: 992px) {
  .table-responsive table {
    min-width: 800px;
  }
}

/* Mobile */
@media (max-width: 768px) {
  .table-responsive table {
    min-width: 700px;
  }
}

/* Header */
.table-responsive thead {
  background: #f1f5f9;
}

.table-responsive th {
  font-weight: 600;
  font-size: 14px;
  padding: 14px;
  white-space: nowrap;
}

/* Body cells */
.table-responsive td {
  font-size: 14px;
  padding: 12px;
  vertical-align: middle;
  white-space: nowrap;
}

/* Allow wrap only for Category column */
.table-responsive td:nth-child(2) {
  white-space: normal;
  max-width: 200px;
  word-break: break-word;
}

/* FIX: Edit & Delete button columns */
.table-responsive td:nth-last-child(1),
.table-responsive td:nth-last-child(2) {
  min-width: 90px;
  white-space: nowrap;
}

/* Buttons visible */
.table-responsive td button {
  display: inline-block;
  margin: 2px 0;
}

/* Row hover */
.table-responsive tbody tr {
  transition: 0.2s ease;
}

.table-responsive tbody tr:hover {
  background: #f8fafc;
}

/* Mobile font & padding */
@media (max-width: 576px) {
  .table-responsive th,
  .table-responsive td {
    font-size: 13px;
    padding: 8px;
  }
}


/* =========================================
   FORCE DESKTOP-LIKE TABLE ON MOBILE
   (SCROLLABLE, NOT CARD VIEW)
========================================= */

/* Enable horizontal scroll */
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* Force real table structure */
.table-responsive table {
  width: 100%;
  min-width: 900px; /* desktop width feel */
  border-collapse: collapse;
}

/* VERY IMPORTANT: undo flex/card styles */
@media (max-width: 1024px) {
  .table-responsive table,
  .table-responsive thead,
  .table-responsive tbody,
  .table-responsive tr {
    display: table !important;
  }

  .table-responsive tr {
    display: table-row !important;
  }

  .table-responsive th,
  .table-responsive td {
    display: table-cell !important;
    white-space: nowrap;
    vertical-align: middle;
    text-align: center;
  }
}

/* Allow product/category name wrap */
.table-responsive td:nth-child(2) {
  white-space: normal;
  min-width: 180px;
  word-break: break-word;
}

/* Fix Edit & Delete column width */
.table-responsive td:nth-last-child(1),
.table-responsive td:nth-last-child(2) {
  min-width: 110px;
}

/* Button visibility */
.table-responsive td button {
  display: inline-block;
  margin: 4px auto;
}


/* ==================================================
   CATEGORY OFFER ‚Äì RESPONSIVE CSS ONLY
================================================== */

/* ---------- SIDEBAR (MOBILE) ---------- */
@media (max-width: 768px) {
  aside {
    transform: translateX(-100%);
    transition: 0.3s ease;
    z-index: 50;
  }

  aside.open {
    transform: translateX(0);
  }

  main {
    margin-left: 0 !important;
    width: 100% !important;
  }

  #menuBtn {
    position: fixed;
    top: 12px;
    left: 12px;
    z-index: 60;
  }
}

/* ---------- TABLE SCROLL ---------- */
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* ---------- TABLE BASE ---------- */
.table-responsive table {
  width: 100%;
  min-width: 900px;
  border-collapse: collapse;
}

/* ---------- HEAD / CELL ---------- */
.table-responsive th,
.table-responsive td {
  white-space: nowrap;
  vertical-align: middle;
  text-align: center;
}

/* ---------- CATEGORY COLUMN (ALLOW WRAP) ---------- */
.table-responsive td:nth-child(2) {
  white-space: normal;
  min-width: 200px;
  word-break: break-word;
}

/* ---------- DATE / STATUS ---------- */
.table-responsive td:nth-child(4),
.table-responsive td:nth-child(5),
.table-responsive td:nth-child(6) {
  min-width: 120px;
}

/* ---------- EDIT / DELETE ---------- */
.table-responsive td:nth-last-child(1),
.table-responsive td:nth-last-child(2) {
  min-width: 110px;
}

.table-responsive td button {
  display: inline-block;
  white-space: nowrap;
}

/* ---------- MOBILE FONT ---------- */
@media (max-width: 576px) {
  .table-responsive th,
  .table-responsive td {
    font-size: 13px;
    padding: 8px;
  }

  .table-responsive table {
    min-width: 800px;
  }
}

/* Mobile font size tuning */
@media (max-width: 576px) {
  .table-responsive th,
  .table-responsive td {
    font-size: 13px;
    padding: 8px;
  }
}

/* ===============================
   BUTTON STYLES
================================ */
.btn-primary.btn-sm {
  background: linear-gradient(135deg, #1976d2, #1565c0);
  border: none;
  border-radius: 8px;
  padding: 6px 14px;
  color: white;
  font-weight: 500;
  transition: 0.25s ease;
}
@media (max-width: 640px) {
  aside {
    transform: translateX(-100%);
    transition: 0.3s;
  }

  aside.open {
    transform: translateX(0);
  }

  main {
    margin-left: 0 !important;
    width: 100% !important;
  }
}
.btn-primary.btn-sm:hover {
  background: linear-gradient(135deg, #2196f3, #0d47a1);
  transform: translateY(-2px);
}

.btn-danger.btn-sm {
  background: linear-gradient(135deg, #e53935, #d32f2f);
  border: none;
  border-radius: 8px;
  padding: 6px 14px;
  color: white;
  font-weight: 500;
  transition: 0.25s ease;
}

.btn-danger.btn-sm:hover {
  background: linear-gradient(135deg, #f44336, #c62828);
  transform: translateY(-2px);
}

/* ===============================
   BADGES
================================ */
.badge.bg-success {
  background: #16a34a !important;
}

.badge.bg-danger {
  background: #dc2626 !important;
}

.badge.bg-warning {
  background: #f59e0b !important;
  color: #1f2937 !important;
}

/* ===============================
   MODAL
================================ */
.modal-content {
  border-radius: 12px !important;
  padding: 20px;
  border: none;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  animation: fadeIn 0.3s ease;
}

.modal-title {
  font-weight: 700;
  color: #0f172a;
}

/* ===============================
   ANIMATION
================================ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

  </style>

  <!-- <style>

    .btn.btn-primary.btn-sm {
  background: linear-gradient(135deg, #1976d2, #1565c0);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 6px 14px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(21, 101, 192, 0.4);
  transition: all 0.25s ease-in-out;
}

.btn.btn-primary.btn-sm:hover {
  background: linear-gradient(135deg, #2196f3, #0d47a1);
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(33, 150, 243, 0.5);
}

.btn.btn-primary.btn-sm:active {
  transform: scale(0.97);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
}

.btn.btn-primary.btn-sm:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.3);
}

    /* Make sure your CSS file is loaded AFTER Bootstrap */
.btn.btn-danger.btn-sm {
  background: linear-gradient(135deg, #e53935, #d32f2f);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 6px 14px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(227, 50, 50, 0.4);
  transition: all 0.25s ease-in-out;
}

.btn.btn-danger.btn-sm:hover {
  background: linear-gradient(135deg, #f44336, #c62828);
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(244, 67, 54, 0.5);
}

.btn.btn-danger.btn-sm:active {
  transform: scale(0.97);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
}

.btn.btn-danger.btn-sm:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(244, 67, 54, 0.3);
}


    
    .btn-success {
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: white; font-weight: 600; border: none; border-radius: 8px;
      padding: 8px 20px; transition: all 0.3s ease;
      box-shadow: 0 2px 6px rgba(22, 163, 74, 0.3);
    }
    .btn-success:hover {
      background: linear-gradient(135deg, #15803d, #16a34a);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(22, 163, 74, 0.4);
    }
    .btn-edit, .btn-delete {
      border-radius: 6px; padding: 5px 12px; transition: all 0.3s ease;
      background-color: white; font-weight: 500;
    }
    .btn-edit { color: #0d6efd; border: 1px solid #0d6efd; }
    .btn-edit:hover { background-color: #0d6efd; color: white; }
    .btn-delete { color: #dc3545; border: 1px solid #dc3545; }
    .btn-delete:hover { background-color: #dc3545; color: white; }
  </style> -->
</head>
<body class="bg-light">



  
<button id="menuBtn"
  class="md:hidden px-3 py-2 bg-green-600 text-white rounded">
  ‚ò∞
</button>


  <aside class="fixed top-0 left-0 h-screen w-64 bg-white shadow-lg z-40">
  
  <!-- Logo -->
  <div class="flex items-center justify-center h-16 border-b">
    <img src="../assets/images/logo/Xe mart.png" class="h-10" />
  </div>

  <!-- Menu -->
  <ul class="flex flex-col gap-2 p-4">

    <li>
      <a href="/admin/dashboard"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üè† <span>Dashboard</span>
      </a>
    </li>

    <li>
      <a href="/admin/products"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üõí <span>Products</span>
      </a>
    </li>

    <li>
      <a href="/admin/categories"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üìÇ <span>Categories</span>
      </a>
    </li>

    <li>
      <a href="/admin/customers"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üë• <span>Customers</span>
      </a>
    </li>

    <li>
      <a href="/admin/orders"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üì¶ <span>Orders</span>
      </a>
    </li>

    <li>
      <a href="/admin/coupons"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üéüÔ∏è <span>Coupons</span>
      </a>
    </li>

    <li>
      <a href="/admin/product-offer"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üí∏ <span>Product Offer</span>
      </a>
    </li>

    <li>
      <a href="/admin/category-offer"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üè∑Ô∏è <span>Category Offer</span>
      </a>
    </li>

    <li>
      <a href="/admin/sales-report"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üìä <span>Sales Report</span>
      </a>
    </li>

    <li class="mt-6">
      <a href="/admin/logout"
         class="flex items-center gap-3 p-2 rounded text-red-600 hover:bg-red-100">
        üö™ <span>Logout</span>
      </a>
    </li>

  </ul>
</aside>




	<div class="main-wrapper">
<main class="pt-6 pt-20 min-h-screen overflow-y-auto"
  style="margin-left:14rem; width:calc(100% - 16rem);">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-semibold text-dark">Category Offers</h2>
    <button class="btn btn-success" id="openModalBtn">+ Add Offer</button>
  </div>


  <form action="" method="get" class="flex items-center gap-2 mb-3">
  <input
    name="search"
    id="category-search"
    value="<%= search || '' %>"
    type="search"
    placeholder="Search Category Offer..."
    autocomplete="off"
    class="border border-gray-300 text-gray-900 rounded-md focus:ring-green-600 focus:ring-1 block p-1.5 px-2 w-1/4 text-sm"
  />
  <button
    type="submit"
    class="px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-sm rounded-md flex items-center justify-center"
  >
    üîç Search
  </button>
</form>


  <!-- Table -->
  <div class="table-responsive bg-white shadow-sm rounded p-3">
    <table class="table table-bordered table-hover align-middle text-center">
      <thead class="table-light">
        <tr>
          <th>S.No</th>
          <th>Category</th>
          <th>Offer %</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Status</th>
          <th>Edit</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        <% if (!offers || offers.length === 0) { %>
          <tr><td colspan="8" class="text-secondary py-4">No Category Offers Found</td></tr>
        <% } else { %>
          <% offers.forEach((o, i) => { %>
            <tr>
              <td><%= i + 1 %></td>
              <td><%= o.category?.name || '-' %></td>
              <td><%= o.offerPercentage %>%</td>
              <td><%= o.startDate?.toISOString().split('T')[0] || '-' %></td>
              <td><%= o.endDate?.toISOString().split('T')[0] || '-' %></td>
            <td>
  <span class="badge 
    <% if (o.status === 'list') { %> bg-success 
    <% } else if (o.status === 'unlist') { %> bg-danger 
    <% } else { %> bg-warning text-dark <% } %>">
    <%= o.status %>
  </span>
</td>

            <td>
  <button class="btn btn-primary btn-sm"
          onclick='openEditModalFromButton(this)'
          data-offer='<%- JSON.stringify(o) %>'>
    Edit
  </button>
</td>


<td>
  <button class="btn btn-danger btn-sm" onclick="deleteOffer('<%= o._id %>')">
    Delete
  </button>
</td>



            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>
  </div>
</main>
  </div>



<!-- Modal -->
<div class="modal fade" id="offerModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content p-3">
      <div class="modal-header">
        <h5 class="modal-title">Add Category Offer</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="offerForm" class="row g-3">
          <input type="hidden" id="offerId">

          <div class="col-12">
            <label>Category</label>
            <select class="form-select" id="categorySelect" >
              <option value="">Choose...</option>
              <% categories.forEach(c => { %>
                <option value="<%= c._id %>"><%= c.name %></option>
              <% }) %>
            </select>
          </div>

          <div class="col-12">
            <label>Offer %</label>
            <input type="number" id="offerPercentage" class="form-control" min="1" max="100" >
          </div>

          <div class="col-12">
            <label>Start Date</label>
            <input type="date" id="startDate" class="form-control" >
          </div>

          <div class="col-12">
            <label>End Date</label>
            <input type="date" id="endDate" class="form-control" >
          </div>

          <div class="col-12">
            <label>Status</label>
            <select id="currentStatus" class="form-select">
              <option value="list">List</option>
              <option value="unlist">Unlist</option>
            </select>
          </div>

          <div class="col-12 d-flex justify-content-end gap-2 mt-2">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-success">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center mt-3">
    <% for(let i = 1; i <= totalPages; i++) { %>
      <li class="page-item <%= i === currentPage ? 'active' : '' %>">
        <a class="page-link" href="?page=<%= i %>"><%= i %></a>
      </li>
    <% } %>
  </ul>
</nav>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- <script>




document.addEventListener('DOMContentLoaded', function () {
  const offerForm = document.getElementById('offerForm');

  offerForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const categoryId = document.getElementById('categorySelect').value;
    const offerPercentage = document.getElementById('offerPercentage').value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    const status = document.getElementById('currentStatus').value;

    if (!categoryId || !offerPercentage || !startDate || !endDate) {
      alert('Please fill in all fields.');
      return;
    }

    const data = {
      categoryId,
      offerPercentage,
      startDate,
      endDate,
      isListed: status === 'list',
    };

    try {
      const response = await fetch('/admin/category-offer/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (response.ok) {
        alert('‚úÖ Offer added successfully!');
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('offerModal'));
        modal.hide();
        // Reload page to see new offer
        window.location.reload();
      } else {
        alert(`‚ùå ${result.message || 'Something went wrong'}`);
      }
    } catch (err) {
      console.error('Error adding offer:', err);
      alert('‚ö†Ô∏è Server error. Please try again later.');
    }
  });
});
const modalEl = document.getElementById("offerModal");
const offerModal = new bootstrap.Modal(modalEl);
const form = document.getElementById("offerForm");

// Open modal for Add
document.getElementById("openModalBtn").addEventListener("click", () => {
  form.reset();
  document.getElementById("offerId").value = "";
  document.querySelector(".modal-title").innerText = "Add Category Offer";
  offerModal.show();
});

// Submit (Add / Edit)
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const id = document.getElementById("offerId").value;
  const categoryId = document.getElementById("categorySelect").value;
  const offerPercentage = Number(document.getElementById("offerPercentage").value);
  const startDate = document.getElementById("startDate").value;
  const endDate = document.getElementById("endDate").value;
  const status = document.getElementById("currentStatus").value;

  if (!categoryId || !offerPercentage || !startDate || !endDate) {
    return Swal.fire("Validation Error", "All fields are required", "warning");
  }

  if (new Date(endDate) <= new Date(startDate)) {
    return Swal.fire("Validation Error", "End date must be after start date", "warning");
  }

  const payload = {
    categoryId,
    offerPercentage,
    startDate,
    endDate,
    isListed: status === "list"
  };
  if (id) payload.categoryOfferId = id;

  const url = id ? '/admin/categoryOffers/updateOffer' : '/admin/categoryOffers/addOffer';
  const method = id ? 'PUT' : 'POST';

  try {
    const res = await fetch(url, {
      method,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (res.ok) Swal.fire("Success", data.message, "success").then(() => location.reload());
    else Swal.fire("Error", data.error || "Something went wrong", "error");
  } catch (err) {
    Swal.fire("Error", "Server request failed", "error");
  }
});

// Edit modal
function openEditModalFromButton(btn) {
  const offer = JSON.parse(btn.dataset.offer);
  document.getElementById("offerId").value = offer._id;
  document.getElementById("categorySelect").value = offer.category;
  document.getElementById("offerPercentage").value = offer.offerPercentage;
  document.getElementById("startDate").value = offer.startDate.split("T")[0];
  document.getElementById("endDate").value = offer.endDate.split("T")[0];
  document.getElementById("currentStatus").value = offer.isListed ? "list" : "unlist";
  document.querySelector(".modal-title").innerText = "Edit Category Offer";
  offerModal.show();
}

// Delete
async function deleteOffer(offerId) {
  const confirmDelete = await Swal.fire({
    title: "Are you sure?",
    text: "This offer will be deleted permanently.",
    icon: "warning",
    showCancelButton: true,
    confirmButtonText: "Yes, delete it!"
  });
  if (!confirmDelete.isConfirmed) return;
  try {
    const res = await fetch(`/admin/categoryOffers/delete/${offerId}`, { method: "DELETE" });
    const data = await res.json();
    if (res.ok) Swal.fire("Deleted!", data.message, "success").then(() => location.reload());
    else Swal.fire("Error", data.error || "Unable to delete", "error");
  } catch (err) {
    Swal.fire("Error", "Server request failed", "error");
  }
}


  async function deleteOffer(id) {
    // SweetAlert confirmation popup
    Swal.fire({
      title: 'Are you sure?',
      text: "You won't be able to revert this!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!'
    }).then(async (result) => {
      if (result.isConfirmed) {
        try {
          const res = await fetch(`/admin/category-offer/delete/${id}`, {
            method: 'DELETE'
          });
          const data = await res.json();

          if (res.ok) {
            Swal.fire({
              title: 'Deleted!',
              text: data.message,
              icon: 'success',
              timer: 1500,
              showConfirmButton: false
            });
            setTimeout(() => location.reload(), 1500);
          } else {
            Swal.fire('Error', data.message || 'Something went wrong', 'error');
          }
        } catch (err) {
          console.error('Error deleting offer:', err);
          Swal.fire('Error', 'Server request failed', 'error');
        }
      }
    });
  }


</script> -->



<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>


const menuBtn = document.getElementById("menuBtn");
const sidebar = document.querySelector("aside");

menuBtn.onclick = () => {
  sidebar.classList.toggle("open");
};

document.addEventListener("DOMContentLoaded", function () {
  const offerForm = document.getElementById("offerForm");
  const modalEl = document.getElementById("offerModal");
  const offerModal = new bootstrap.Modal(modalEl);
  const openModalBtn = document.getElementById("openModalBtn");

  // üü¢ Open Add Modal
  if (openModalBtn) {
    openModalBtn.addEventListener("click", () => {
      offerForm.reset();
      document.getElementById("offerId").value = "";
      document.querySelector(".modal-title").innerText = "Add Category Offer";
      document.getElementById("currentStatus").value = "list"; // default
      offerModal.show();
    });
  }

  // üü¢ Handle Add / Edit Submit
  offerForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const id = document.getElementById("offerId").value;
    const categoryId = document.getElementById("categorySelect").value;
    const offerPercentage = Number(document.getElementById("offerPercentage").value);
    const startDate = document.getElementById("startDate").value;
    const endDate = document.getElementById("endDate").value;
    const status = document.getElementById("currentStatus").value;

    if (!categoryId || !offerPercentage || !startDate || !endDate) {
      return Swal.fire("Validation Error", "All fields are required", "warning");
    }

    if (new Date(endDate) <= new Date(startDate)) {
      return Swal.fire("Validation Error", "End date must be after start date", "warning");
    }

    const payload = {
      categoryId,
      offerPercentage,
      startDate,
      endDate,
      isListed: status === "list",
    };

    const url = id
      ? `/admin/category-offer/update/${id}`
      : `/admin/category-offer/add`;
    const method = id ? "PUT" : "POST";

    try {
      const res = await fetch(url, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const data = await res.json();

      if (res.ok) {
        Swal.fire("Success", data.message || "Offer saved successfully!", "success")
          .then(() => location.reload());
      } else {
        Swal.fire("Error", data.message || "Something went wrong", "error");
      }
    } catch (err) {
      console.error("Error adding/editing offer:", err);
      Swal.fire("Error", "Server request failed", "error");
    }
  });
});

// üü° Open Edit Modal (from button)
function openEditModalFromButton(btn) {
  const offer = JSON.parse(btn.dataset.offer);
  document.getElementById("offerId").value = offer._id;
  document.getElementById("categorySelect").value = offer.category._id || offer.category;
  document.getElementById("offerPercentage").value = offer.offerPercentage;
  document.getElementById("startDate").value = offer.startDate.split("T")[0];
  document.getElementById("endDate").value = offer.endDate.split("T")[0];
  document.getElementById("currentStatus").value = offer.isListed ? "list" : "unlist";
  document.querySelector(".modal-title").innerText = "Edit Category Offer";
  const modalEl = document.getElementById("offerModal");
  const offerModal = new bootstrap.Modal(modalEl);
  offerModal.show();
}

// üî¥ Delete Offer with SweetAlert
async function deleteOffer(id) {
  const confirmDelete = await Swal.fire({
    title: "Are you sure?",
    text: "This offer will be permanently deleted.",
    icon: "warning",
    showCancelButton: true,
    confirmButtonText: "Yes, delete it!",
    cancelButtonText: "Cancel",
  });

  if (!confirmDelete.isConfirmed) return;

  try {
    const res = await fetch(`/admin/category-offer/delete/${id}`, {
      method: "DELETE",
    });
    const data = await res.json();

    if (res.ok) {
      Swal.fire({
        title: "Deleted!",
        text: data.message,
        icon: "success",
        timer: 1500,
        showConfirmButton: false,
      });
      setTimeout(() => location.reload(), 1500);
    } else {
      Swal.fire("Error", data.message || "Something went wrong", "error");
    }
  } catch (err) {
    console.error("Error deleting offer:", err);
    Swal.fire("Error", "Server request failed", "error");
  }
}
</script>


</body>
</html>
