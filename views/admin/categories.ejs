<!doctype html>
<html lang="en">


<!-- Mirrored from freshcart-tailwind.codescandy.com/dashboard/categories.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Dec 2024 13:19:37 GMT -->
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="shortcut icon" type="image/x-icon" href="../assets/images/favicon/favicon.ico" />

<!-- Libs CSS -->
<link rel="preconnect" href="https://fonts.googleapis.com/" />
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" />
<link rel="stylesheet" href="../../cdn.jsdelivr.net/npm/%40tabler/icons-webfont%402.46.0/tabler-icons.min.css" />
<link rel="stylesheet" href="../assets/libs/simplebar/dist/simplebar.min.css" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Theme CSS -->
<link rel="stylesheet" href="../assets/css/theme.min.css">
<style>/* -------------------------
   GENERAL LAYOUT
--------------------------*/
body {
  font-family: "Inter", sans-serif;
  background: #f8fafc;
  margin: 0;
  padding: 0;
  color: #1e293b;
}

/* Fix Top Navbar */
nav.w-full {
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  padding: 10px 0;
}

/* Space below navbar */
.main-content-wrapper {
  margin-top: 30px !important;
}

/* -------------------------
   PAGE TITLES
--------------------------*/
h2.text-xl {
  font-size: 24px;
  font-weight: 700;
  color: #0f172a;
}

/* Breadcrumb */
nav[aria-label="breadcrumb"] ol li {
  font-size: 14px;
}

/* -------------------------
   SEARCH BAR
--------------------------*/
#categorySearchInput {
  border-radius: 10px;
  padding: 10px 14px;
  border: 1px solid #cbd5e1;
  transition: 0.25s ease;
}

#categorySearchInput:focus {
  border-color: #22c55e;
  box-shadow: 0 0 0 3px rgba(34,197,94,0.25);
}

/* Search Button */
#categorySearchForm button {
  padding: 10px 20px;
  border-radius: 10px;
  background: #16a34a;
  color: #fff;
  transition: 0.2s ease;
}

#categorySearchForm button:hover {
  background: #15803d;
}

/* -------------------------
   TABLE DESIGN
--------------------------*/
table {
  border-radius: 12px;
  overflow: hidden;
  background: #fff;
}

table thead {
  background: #f1f5f9;
}

table th {
  font-weight: 600;
  padding: 14px;
}

table td {
  padding: 16px;
  font-size: 15px;
}

table tbody tr {
  transition: 0.2s ease;
}

table tbody tr:hover {
  background: #f8fafc;
}

/* Description cell scroll */
td div.max-h-24 {
  scrollbar-width: thin;
  scrollbar-color: #94a3b8 #f8fafc;
}

td div.max-h-24::-webkit-scrollbar {
  width: 6px;
}
td div.max-h-24::-webkit-scrollbar-thumb {
  background: #94a3b8;
  border-radius: 10px;
}

/* -------------------------
   BUTTONS
--------------------------*/
button {
  font-size: 14px;
}

/* Edit */
.editCategoryBtn {
  background: #2563eb !important;
  color: #fff;
  border-radius: 8px;
  padding: 6px 12px;
}
.editCategoryBtn:hover {
  background: #1e40af !important;
}

/* Delete / Unlist */
.deleteCategoryBtn,
.toggleCategoryBtn {
  color: #fff;
  padding: 6px 12px;
  border-radius: 8px;
}


/* ==================================================
   CATEGORY PAGE ‚Äì RESPONSIVE CSS ONLY
================================================== */

/* ---------- SIDEBAR (MOBILE) ---------- */
@media (max-width: 768px) {
  aside {
    transform: translateX(-100%);
    transition: 0.3s ease;
    z-index: 50;
  }

  aside.open {
    transform: translateX(0);
  }

  main {
    margin-left: 0 !important;
    width: 100% !important;
  }

  #menuBtn {
    position: fixed;
    top: 12px;
    left: 12px;
    z-index: 60;
  }
}

/* ---------- TABLE SCROLL ---------- */
.relative.overflow-x-auto {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* ---------- TABLE BASE ---------- */
#categoriesTable {
  width: 100%;
  min-width: 900px;
  border-collapse: collapse;
}

#categoriesTable th,
#categoriesTable td {
  white-space: nowrap;
  vertical-align: top;
}

/* ---------- DESCRIPTION COLUMN ---------- */
#categoriesTable td:nth-child(3) {
  white-space: normal;
  max-width: 400px;
}

/* ---------- ACTION BUTTONS ---------- */
#categoriesTable td:last-child {
  min-width: 180px;
}

.editCategoryBtn,
.toggleCategoryBtn {
  white-space: nowrap;
}

/* ---------- MOBILE POLISH ---------- */
@media (max-width: 640px) {
  h2.text-xl {
    font-size: 18px;
  }

  #categoriesTable {
    min-width: 850px;
  }

  .card {
    border-radius: 12px;
  }

  .px-6 {
    padding-left: 12px !important;
    padding-right: 12px !important;
  }
}

:root {
  --primary: #16a34a;
  --primary-dark: #059669;
  --bg-main: #f5f7fa;
  --sidebar-bg: #ffffff;
  --danger: #dc2626;
}



/* Active ‚Üí Red */
.toggleCategoryBtn.bg-red-600:hover {
  background: #b91c1c !important;
}

/* Inactive ‚Üí Green */
.toggleCategoryBtn.bg-green-600:hover {
  background: #15803d !important;
}

/* Add Category Button */
#addCategoryBtn {
  background: #16a34a;
  padding: 10px 20px;
  border-radius: 10px;
}
#addCategoryBtn:hover {
  background: #15803d;
}

/* -------------------------
   MODAL DESIGN
--------------------------*/
#addCategoryModal,
#editCategoryModal {
  backdrop-filter: blur(3px);
  animation: fadeIn 0.35s ease;
}

#addCategoryModal .bg-white,
#editCategoryModal .bg-white {
  border-radius: 18px;
  padding: 25px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  animation: scaleIn 0.3s ease;
}

/* Modal Inputs */
#addCategoryModal input,
#addCategoryModal textarea,
#editCategoryModal input,
#editCategoryModal textarea {
  width: 100%;
  border: 1px solid #cbd5e1;
  padding: 10px 12px;
  border-radius: 10px;
  transition: 0.2s ease;
}

#addCategoryModal input:focus,
#editCategoryModal input:focus,
#addCategoryModal textarea:focus,
#editCategoryModal textarea:focus {
  border-color: #22c55e;
  box-shadow: 0 0 0 3px rgba(34,197,94,0.25);
}

/* Cancel Button */
#closeCategoryModal,
#closeEditModal {
  background: #e2e8f0;
  padding: 8px 16px;
  border-radius: 8px;
}
#closeCategoryModal:hover,
#closeEditModal:hover {
  background: #cbd5e1;
}

/* Save / Update buttons */
#addCategoryModal button[type="submit"],
#editCategoryModal button[type="submit"] {
  background: #16a34a;
  color: white;
  border-radius: 8px;
  padding: 8px 16px;
}
#addCategoryModal button[type="submit"]:hover,
#editCategoryModal button[type="submit"]:hover {
  background: #15803d;
}

/* -------------------------
   PAGINATION
--------------------------*/
.pagination a {
  border-radius: 8px;
  padding: 8px 12px;
  border: 1px solid #cbd5e1;
  transition: 0.2s ease;
}

.pagination a:hover {
  background: #f1f5f9;
}


@media (max-width: 640px) {
  aside {
    transform: translateX(-100%);
    transition: 0.3s;
  }

  aside.open {
    transform: translateX(0);
  }

  main {
    margin-left: 0 !important;
    width: 100% !important;
  }
}



.pagination .active {
  background: #16a34a !important;
  color: white !important;
}

/* -------------------------
   ANIMATIONS
--------------------------*/
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes scaleIn {
  from { transform: scale(0.95); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
</style>

	<title>category</title>
</head>

<body>

<aside class="fixed top-0 left-0 h-screen w-64 bg-white shadow-lg z-40">
  
  <!-- Logo -->
  <div class="flex items-center justify-center h-16 border-b">
    <img src="../assets/images/logo/Xe mart.png" class="h-10" />
  </div>

  <!-- Menu -->
  <ul class="flex flex-col gap-2 p-4">

    <li>
      <a href="/admin/dashboard"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üè† <span>Dashboard</span>
      </a>
    </li>

    <li>
      <a href="/admin/products"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üõí <span>Products</span>
      </a>
    </li>

    <li>
      <a href="/admin/categories"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üìÇ <span>Categories</span>
      </a>
    </li>

    <li>
      <a href="/admin/customers"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üë• <span>Customers</span>
      </a>
    </li>

    <li>
      <a href="/admin/orders"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üì¶ <span>Orders</span>
      </a>
    </li>

    <li>
      <a href="/admin/coupons"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üéüÔ∏è <span>Coupons</span>
      </a>
    </li>

    <li>
      <a href="/admin/product-offer"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üí∏ <span>Product Offer</span>
      </a>
    </li>

    <li>
      <a href="/admin/category-offer"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üè∑Ô∏è <span>Category Offer</span>
      </a>
    </li>

    <li>
      <a href="/admin/sales-report"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üìä <span>Sales Report</span>
      </a>
    </li>

    <li class="mt-6">
      <a href="/admin/logout"
         class="flex items-center gap-3 p-2 rounded text-red-600 hover:bg-red-100">
        üö™ <span>Logout</span>
      </a>
    </li>

  </ul>
</aside>


<button id="menuBtn"
  class="md:hidden px-3 py-2 bg-green-600 text-white rounded">
  ‚ò∞
</button>




			<!-- navbar -->
<div class="main-wrapper">
			<main  class="pt-6 pt-20 min-h-screen overflow-y-auto"
  style="margin-left:14rem; width:calc(100% - 16rem);">
				<div >
					<div class="grid grid-cols-1 mb-8">
						<!-- page header -->
						<div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
							<div>
								<h2 class="text-xl">Categories</h2>
								<!-- breacrumb -->
								<nav aria-label="breadcrumb">
									<ol class="flex flex-wrap">
										<li class="inline-block text-green-600">
											<a href="/admin/dashboard">
												Dashboard
												<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14"
													viewBox="0 0 24 24" fill="none" stroke="currentColor"
													stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
													class="icon icon-tabler icons-tabler-outline icon-tabler-slash inline-block mx-2">
													<path stroke="none" d="M0 0h24v24H0z" fill="none" />
													<path d="M17 5l-10 14" />
												</svg>
											</a>
										</li>

										<li class="inline-block text-gray-500 active" aria-current="page">Categories
										</li>
									</ol>
								</nav>
							</div>
							<!-- button -->


<form id="categorySearchForm" class="flex mb-4" role="search">
  <input
    id="categorySearchInput"
    class="border border-gray-300 text-gray-900 rounded-lg focus:shadow-[0_0_0_.25rem_rgba(10,173,10,.25)] focus:ring-green-600 focus:ring-0 focus:border-green-600 block p-2 px-3 w-full text-base"
    type="search"
    placeholder="Search Category"
    aria-label="Search"
	autocomplete="off" 
  />
   <button type="submit" class="ml-2 px-4 py-2 bg-green-600 text-white rounded-lg">Search</button>
</form>




						</div>
					</div>
					<!-- row -->
					<div class="grid grid-cols-1">
						<!-- card -->
						<div class="card h-full card-lg">
							<div class="px-6 py-6">
								<div class="grid grid-cols-12 justify-between gap-2">
									<div class="lg:col-span-3 md:col-span-6 col-span-12">
										<!-- form -->
										<!-- <form class="flex" role="search">
											<input
												class="border border-gray-300 text-gray-900 rounded-lg focus:shadow-[0_0_0_.25rem_rgba(10,173,10,.25)] focus:ring-green-600 focus:ring-0 focus:border-green-600 block p-2 px-3 disabled:opacity-50 disabled:pointer-events-none w-full text-base"
												type="search" placeholder="Search Category" aria-label="Search" />
										</form> -->
<div class="flex justify-center mt-10">
<button id="addCategoryBtn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
  Add New Category
</button>
</div>

<!-- Modal -->

<!-- Add Category Modal -->
<!-- Add Category Modal -->
<div id="addCategoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white rounded-2xl shadow-lg w-96 p-6">
    <h2 class="text-lg font-bold mb-4">Add Category</h2>
    <form id="categoryForm">
      <input type="text" id="categoryName" placeholder="Category Name" class="w-full border rounded px-3 py-2 mb-4">
      <textarea id="categoryDescription" placeholder="Category Description" class="w-full border rounded px-3 py-2 mb-4"></textarea>
      <p id="categoryError" class="text-red-500 text-sm mb-2 hidden"></p>
      <div class="flex justify-end gap-2">
        <button type="button" id="closeCategoryModal" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Save</button>
      </div>
    </form>
  </div>
</div>




									</div>
									<!-- select option -->
									<!-- <div class="md:col-start-11 md:col-end-13 md:col-span-4 col-span-12">
										<select
											class="text-base py-2 block w-full border-gray-300 rounded-lg focus:border-green-600 focus:ring-green-600 disabled:opacity-50 disabled:pointer-events-none">
											<option selected>Status</option>
											<option value="Published">Published</option>
											<option value="Unpublished">Unpublished</option>
										</select>
									</div> -->
								</div>
							</div>











							<!-- card body -->
							



							<div class="card-body p-0">
  <!-- table -->
  





<div class="relative overflow-x-auto">
  <table id="categoriesTable" class="text-left w-full whitespace-normal table-with-checkbox border border-gray-300 shadow-sm rounded-lg">
    <thead class="bg-gray-100 text-gray-800 border-b-2 border-gray-400">
      <tr>
        <th scope="col" class="px-6 py-3 w-[5%]"></th>
        <th scope="col" class="px-6 py-3 w-[20%]">Category Name</th>
        <th scope="col" class="px-6 py-3 w-[40%]">Description</th>
        <th scope="col" class="px-6 py-3 w-[20%]">Add Date</th>
        <th scope="col" class="px-6 py-3 w-[15%]">Action</th>
      </tr>
    </thead>
    <tbody id="categoryResults">
      <% categories.forEach((category, index) => { %>
        <tr id="row-<%= category._id %>" class="border-b border-gray-300 bg-white hover:bg-gray-50 transition-colors duration-200" style="height: 180px;">
          <td class="py-3 px-6 text-left align-top"></td>
          <td class="py-3 px-6 text-left align-top font-medium text-gray-700"><%= category.name %></td>
          <!-- <td class="py-3 px-6 text-left align-top break-words" style="white-space: normal; word-wrap: break-word; height: 100%; overflow-wrap: break-word;">
            <div class="h-full overflow-hidden text-gray-600">
              <%= category.description %>
            </div>
          </td> -->

		  <td class="py-3 px-6 text-left align-top break-words" style="max-width: 400px; width: 400px;">
  <div class="max-h-24 overflow-y-auto text-gray-600 break-words">
    <%= category.description %>
  </div>
</td>

          <td class="py-3 px-6 text-left align-top text-gray-500"><%= category.createdAt.toDateString() %></td>
          <td class="py-3 px-6 text-left flex gap-2 align-top">
            <button
              class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm transition-colors duration-200 editCategoryBtn"
              data-id="<%= category._id %>"
              data-name="<%= category.name %>"
              data-description="<%= category.description %>">
              Edit
            </button>
         <button
  class="px-3 py-1 rounded <%= category.isDeleted ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700' %> text-white shadow-sm transition-colors duration-200 toggleCategoryBtn"
  data-id="<%= category._id %>">
  <%= category.isDeleted ? 'list' : 'unlist' %>
</button>

  <!-- <button
    class="px-3 py-1 rounded <%= category.isBlocked ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700' %> text-white shadow-sm transition-colors duration-200 toggleBlockBtn"
    data-id="<%= category._id %>">
    <%= category.isBlocked ? 'Block' : 'Unblock' %>
  </button> -->
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>











</div>














<div id="editCategoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white rounded-2xl shadow-lg w-96 p-6">
    <h2 class="text-lg font-bold mb-4">Edit Category</h2>
    <form id="editCategoryForm">
      <input type="hidden" id="editCategoryId">
      <input type="text" id="editCategoryName" placeholder="Category Name" class="w-full border rounded px-3 py-2 mb-4">
      <textarea id="editCategoryDescription" placeholder="Category Description" class="w-full border rounded px-3 py-2 mb-4"></textarea>
      <p id="editCategoryError" class="text-red-500 text-sm mb-2 hidden"></p>
      <div class="flex justify-end gap-2">
        <button type="button" id="closeEditModal" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Update</button>
      </div>
    </form>
  </div>
</div>








<div class="border-t border-gray-300 flex flex-col md:flex-row justify-between items-center px-6 py-6 gap-3">
  <span>
    Showing <%= (currentPage - 1) * 8 + 1 %> 
    to <%= Math.min(currentPage * 8, totalCategories) %> 
    of <%= totalCategories %> entries
  </span>

  <nav class="flex items-center gap-x-1">
    <a href="/admin/categories?page=<%= currentPage - 1 %>" 
       class="px-4 py-2 border rounded bg-white hover:bg-gray-300 <%= currentPage === 1 ? 'opacity-50 pointer-events-none' : '' %>">
      Previous
    </a>

    <% for(let i = 1; i <= totalPages; i++) { %>
      <a href="/admin/categories?page=<%= i %>"
         class="px-3 py-2 border rounded <%= currentPage === i ? 'bg-green-600 text-white border-green-600' : 'bg-white text-gray-800 border-gray-300 hover:bg-gray-300' %>">
         <%= i %>
      </a>
    <% } %>

    <a href="/admin/categories?page=<%= currentPage + 1 %>" 
       class="px-4 py-2 border rounded bg-white hover:bg-gray-300 <%= currentPage === totalPages ? 'opacity-50 pointer-events-none' : '' %>">
      Next
    </a>
  </nav>
</div>







						</div>
					</div>
				</div>
			</main>
</div>


			<!-- main -->

	

	<!-- Libs JS -->
<script src="../assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="../assets/libs/simplebar/dist/simplebar.min.js"></script>

<!-- Theme JS -->

<script src="../assets/js/theme.min.js"></script>






<!-- Include SweetAlert2 -->








<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>






<script>




document.querySelectorAll('.toggleBlockBtn').forEach(btn => {
  btn.addEventListener('click', async (e) => {
    const categoryId = e.currentTarget.dataset.id;
    const currentBtn = e.currentTarget;

    const confirmResult = await Swal.fire({
      title: 'Are you sure?',
      text: `You are about to ${currentBtn.innerText.toLowerCase()} this category!`,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, proceed!'
    });

    if (!confirmResult.isConfirmed) return;

    try {
      const res = await fetch(`/admin/category/toggle-block/${categoryId}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' }
      });

      if (res.ok) {
        const data = await res.json();
    
        Swal.fire({
          icon: 'success',
          title: `Category ${data.isBlocked ? 'blocked' : 'unblocked'}!`,
          showConfirmButton: false,
          timer: 1500
        }).then(() => window.location.reload());
      } else {
        Swal.fire('Error', 'Failed to toggle block status', 'error');
      }
    } catch (err) {
      console.error(err);
      Swal.fire('Error', 'Something went wrong', 'error');
    }
  });
});







// document.querySelectorAll('.toggleBlockBtn').forEach(btn => {
//   btn.addEventListener('click', async (e) => {
//     const categoryId = e.currentTarget.dataset.id;

//     try {
//       const res = await fetch(`/admin/category/toggle-block/${categoryId}`, {
//         method: 'PATCH',
//         headers: { 'Content-Type': 'application/json' }
//       });

//       if (res.ok) window.location.reload(); // page reload to reflect changes
//       else alert('Failed to toggle block status');
//     } catch (err) {
//       console.error(err);
//       alert('Something went wrong');
//     }
//   });
// });

















document.addEventListener("DOMContentLoaded", () => {
  // ===== Toggle Category Active/Inactive =====

document.querySelectorAll('.toggleCategoryBtn').forEach(btn => {
  btn.addEventListener('click', async () => {
    const catId = btn.dataset.id;

    const result = await Swal.fire({
      title: 'Are you sure?',
      text: "Do you want to toggle this category?",
      icon: 'question',
      showCancelButton: true,
      confirmButtonText: 'Yes',
      cancelButtonText: 'No',
      reverseButtons: true
    });

    if (!result.isConfirmed) return;

    try {
      const res = await fetch(`/admin/categories/toggle/${catId}`, { method: 'POST' });
      const data = await res.json();
      if(res.ok){
        Swal.fire({ icon:'success', text: data.message, timer:1500, showConfirmButton:false })
          .then(() => window.location.reload())
      } else {
        Swal.fire({ icon:'error', text: data.message || 'Something went wrong' })
      }
    } catch(err){
      Swal.fire({ icon:'error', text:'Server error' })
    }
  })
})


  // ===== Elements =====
  const catForm = document.getElementById("categorySearchForm")
  const catInput = document.getElementById("categorySearchInput")
  const catResults = document.getElementById("categoryResults")
  const categoryModal = document.getElementById("addCategoryModal")
  const openCategoryBtn = document.getElementById("addCategoryBtn")
  const closeCategoryBtn = document.getElementById("closeCategoryModal")
  const categoryForm = document.getElementById("categoryForm")
  const editModal = document.getElementById("editCategoryModal")
  const editForm = document.getElementById("editCategoryForm")
  const editId = document.getElementById("editCategoryId")
  const editName = document.getElementById("editCategoryName")
  const editDescription = document.getElementById("editCategoryDescription")
  let timeout;

  // ===== Live Search =====
  catForm.addEventListener("submit", e => {
    e.preventDefault();
    performCatSearch(catInput.value.trim())
  });

  catInput.addEventListener("input", () => {
    clearTimeout(timeout);
    const query = catInput.value.trim();
    timeout = setTimeout(() => performCatSearch(query), 300)
  });

  async function performCatSearch(query) {
    if (!query) {
      window.location.reload();
      return;
    }
    try {
      const res = await fetch(`/admin/categories/search?search=${encodeURIComponent(query)}`)
      const data = await res.json();
      if (data.success && data.categories.length > 0) {
        let html = "";
        data.categories.forEach(cat => {
          html += `
            <tr id="row-${cat._id}" class="border-b border-gray-300 bg-white hover:bg-gray-50 transition-colors duration-200" style="height:180px;">
              <td class="py-3 px-6 text-left align-top"></td>
              <td class="py-3 px-6 text-left align-top font-medium text-gray-700">${cat.name}</td>
              <td class="py-3 px-6 text-left align-top break-words" style="white-space: normal; word-wrap: break-word; overflow-wrap: break-word;">
                <div class="h-full overflow-hidden text-gray-600">${cat.description}</div>
              </td>
              <td class="py-3 px-6 text-left align-top text-gray-500">${new Date(cat.createdAt).toDateString()}</td>
              <td class="py-3 px-6 text-left flex gap-2 align-top">
                <button class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm transition-colors duration-200 editCategoryBtn"
                        data-id="${cat._id}" data-name="${cat.name}" data-description="${cat.description}">
                  Edit
                </button>
                <button class="deleteCategoryBtn px-3 py-1 rounded bg-red-600 text-white hover:bg-red-700 shadow-sm transition-colors duration-200"
                        data-id="${cat._id}">
                  Delete
                </button>
              </td>
            </tr>`;
        });
        catResults.innerHTML = html;

        document.querySelectorAll("#categoryResults tr").forEach(row => attachRowEvents(row));
      } else {
        catResults.innerHTML = "";
        // Swal.fire({
        //   icon: "error",
        //   title: "Category not found",
        //   text: `No categories matched "${query}"`,
        // });
      }
    } catch (err) {
      console.error(err);
      Swal.fire("Error", "Server error occurred.", "error");
    }
  }

  // ===== Add Category =====
  openCategoryBtn.addEventListener("click", () => {
    categoryForm.reset();
    categoryModal.classList.remove("hidden");
  });

  closeCategoryBtn.addEventListener("click", () => {
    categoryModal.classList.add("hidden");
  });

categoryForm.addEventListener("submit", async e => {
  e.preventDefault();
  const name = document.getElementById("categoryName").value.trim();
  const description = document.getElementById("categoryDescription").value.trim();

  if (!name) {
    Swal.fire(' Error', 'Please enter category name.', 'warning');
    return;
  } 
  if (name.length < 4) {
    Swal.fire(' Error', 'Category name must be at least 4 characters.', 'warning');
    return;
  }
  if (name.length > 15) {
    Swal.fire(' Error', 'Category name should not exceed 15 characters.', 'warning');
    return;
  }
  if (!description || description.length < 30) {
    Swal.fire(' Error', 'Please provide a valid description (minimum 30 characters).', 'warning');
    return;
  }

  try {
    const res = await fetch("/admin/categories/add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, description })
    });
    const data = await res.json();

    if (data.success) {
      categoryForm.reset();
      categoryModal.classList.add("hidden");

      const tableBody = document.querySelector("#categoriesTable tbody");
      const newRow = document.createElement("tr");
      newRow.id = `row-${data.category._id}`;
      newRow.className = "border-b border-gray-300 bg-white hover:bg-gray-50 transition-colors duration-200";
      newRow.style.height = "180px";
      newRow.innerHTML = `
        <td class="py-3 px-6 text-left align-top"></td>
        <td class="py-3 px-6 text-left align-top font-medium text-gray-700">${data.category.name}</td>
        <td class="py-3 px-6 text-left align-top break-words" style="white-space: normal; word-wrap: break-word; overflow-wrap: break-word;">
          <div class="h-full overflow-hidden text-gray-600">${data.category.description}</div>
        </td>
        <td class="py-3 px-6 text-left align-top text-gray-500">${new Date(data.category.createdAt).toDateString()}</td>
        <td class="py-3 px-6 text-left flex gap-2 align-top">
          <button class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm transition-colors duration-200 editCategoryBtn"
                  data-id="${data.category._id}" data-name="${data.category.name}" data-description="${data.category.description}">
            Edit
          </button>
          <button class="deleteCategoryBtn px-3 py-1 rounded bg-red-600 text-white hover:bg-red-700 shadow-sm transition-colors duration-200"
                  data-id="${data.category._id}">
            Delete
          </button>
        </td>`;
      tableBody.prepend(newRow);
      attachRowEvents(newRow);

      Swal.fire('Success', 'Category added successfully!', 'success');
    } else {
      Swal.fire(' Error', data.message, 'error');
    }
  } catch (err) {
    Swal.fire(' Error', 'Server error, please try again.', 'error');
  }
});



const menuBtn = document.getElementById("menuBtn");
const sidebar = document.querySelector("aside");

menuBtn.onclick = () => {
  sidebar.classList.toggle("open");
};


  
  // ===== Attach edit & delete events =====
  function attachRowEvents(row) {
    const editBtn = row.querySelector(".editCategoryBtn");
    const deleteBtn = row.querySelector(".deleteCategoryBtn");

    if (editBtn) {
      editBtn.addEventListener("click", () => {
        editId.value = editBtn.dataset.id;
        editName.value = editBtn.dataset.name;
        editDescription.value = editBtn.dataset.description;
        editModal.classList.remove("hidden");
      });
    }

    if (deleteBtn) {
      deleteBtn.addEventListener("click", async e => {
        e.preventDefault();
        const id = deleteBtn.dataset.id;
        const result = await Swal.fire({
          title: 'Are you sure?',
          text: "You won't be able to revert this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Yes, delete it!',
          cancelButtonText: 'Cancel'
        });
        if (!result.isConfirmed) return;

        try {
          const res = await fetch(`/admin/categories/delete/${id}`);
          const data = await res.json();
          if (data.success) {
            const row = document.getElementById(`row-${id}`);
            if (row) row.remove();
            Swal.fire('Deleted!', 'Category has been deleted.', 'success').then(() => location.reload());
          } else {
            Swal.fire(' Error', data.message, 'error');
          }
        } catch (err) {
          Swal.fire(' Error', 'Server error, please try again.', 'error');
        }
      });
    }
  }

  // ===== Initialize existing edit buttons =====
  document.querySelectorAll(".editCategoryBtn").forEach(btn => attachRowEvents(btn.closest("tr")));

  document.getElementById("closeEditModal").addEventListener("click", () => {
    editModal.classList.add("hidden");
  });

  // ===== Edit Category =====
// ===== Edit Category =====
editForm.addEventListener("submit", async e => {
  e.preventDefault();

  const id = editId.value.trim();
  const name = editName.value.trim();
  const description = editDescription.value.trim();

  if (!name || name.length < 3) {
    Swal.fire('Error', 'Name must be at least 3 characters.', 'warning');
    return;
  }

  if (name.length > 20) {
    Swal.fire('Error', 'Name should not exceed 20 characters.', 'warning');
    return;
  }

  if (!description || description.length < 30) {
    Swal.fire('Error', 'Description must be at least 30 characters.', 'warning');
    return;
  }

  // ‚≠ê 100 CHARACTER LIMIT FOR DESCRIPTION
  if (description.length > 200) {
    Swal.fire(
      'Error',
      `Description should not exceed 200 characters. (Now: ${description.length})`,
      'warning'
    );
    return;
  }

  try {
    const res = await fetch(`/admin/categories/edit/${id}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, description })
    });

    const data = await res.json();

    if (data.success) {
      const row = document.getElementById(`row-${id}`);
      row.children[1].innerText = name;
      row.children[2].innerText = description;

      editModal.classList.add("hidden");
      Swal.fire('Success', 'Category updated successfully!', 'success');
    } else {
      Swal.fire('Error', data.message, 'error');
    }
  } catch (err) {
    Swal.fire('Error', 'Server error, please try again.', 'error');
  }
});

});




</script>

















</body>


<!-- Mirrored from freshcart-tailwind.codescandy.com/dashboard/categories.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Dec 2024 13:19:40 GMT -->
</html>