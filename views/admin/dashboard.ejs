<!doctype html>
<html lang="en">


<!-- Mirrored from freshcart-tailwind.codescandy.com/dashboard/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Dec 2024 13:19:20 GMT -->
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="../assets/images/favicon/favicon.ico" />

<!-- Libs CSS -->
<link rel="preconnect" href="https://fonts.googleapis.com/" />
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" />
<link rel="stylesheet" href="../../cdn.jsdelivr.net/npm/%40tabler/icons-webfont%402.46.0/tabler-icons.min.css" />
<link rel="stylesheet" href="../assets/libs/simplebar/dist/simplebar.min.css" />

<!-- Theme CSS -->
<link rel="stylesheet" href="../assets/css/theme.min.css">

<style>
  /* =====================================================
   DASHBOARD ‚Äì FINAL RESPONSIVE FIX
   (CSS ONLY | NO HTML / JS CHANGE)
===================================================== */

/* ---------- GLOBAL ---------- */
body {
  overflow-x: hidden;
}

/* ---------- SIDEBAR (MOBILE) ---------- */
@media (max-width: 768px) {
  aside {
    transform: translateX(-100%);
    transition: 0.3s ease;
    z-index: 60;
  }

  aside.open {
    transform: translateX(0);
  }

  #menuBtn {
    position: fixed;
    top: 12px;
    left: 12px;
    z-index: 100;
  }

  main {
    margin-left: 0 !important;
    width: 100% !important;
    padding-top: 70px !important;
  }
}

/* ---------- WELCOME CARD ---------- */
@media (max-width: 768px) {
  .card.bg-gray-100 h1 {
    font-size: 22px;
  }

  .card.bg-gray-100 p {
    font-size: 14px;
  }

  .card.bg-gray-100 .btn {
    width: 100%;
    text-align: center;
  }
}

/* ---------- DASHBOARD STATS CARDS ---------- */
@media (max-width: 768px) {
  .card-lg {
    margin-bottom: 16px;
  }

  .card-lg h4 {
    font-size: 15px;
  }

  .card-lg h1 {
    font-size: 20px;
  }
}

/* ---------- GRID FIX ---------- */
@media (max-width: 1024px) {
  .grid.grid-cols-12 > div {
    grid-column: span 12 / span 12 !important;
  }
}

/* ---------- REVENUE CARD ---------- */
@media (max-width: 768px) {
  #revenueFilter {
    width: 100%;
    margin-top: 10px;
  }

  #dateFilterForm {
    flex-direction: column;
    gap: 10px;
  }

  #dateFilterForm input,
  #dateFilterForm button {
    width: 100%;
  }
}

/* ---------- CHARTS ---------- */
@media (max-width: 768px) {
  canvas {
    max-width: 100%;
    height: auto !important;
  }
}

/* ---------- DOWNLOAD MENU ---------- */
@media (max-width: 768px) {
  #downloadMenu {
    right: auto;
    left: 0;
  }
}

/* ---------- TOP SELLING PRODUCTS ---------- */
@media (max-width: 768px) {
  #bestProductsList li {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }

  #bestProductsList img {
    width: 60px;
    height: 60px;
  }
}

/* ---------- TOP SELLING CATEGORY ---------- */
@media (max-width: 768px) {
  #bestCategoryBox > div {
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
  }
}

/* ---------- GENERAL MOBILE FONT ---------- */
@media (max-width: 576px) {
  h1 {
    font-size: 20px;
  }

  h3 {
    font-size: 16px;
  }

  h4 {
    font-size: 14px;
  }

  p,
  span,
  li {
    font-size: 13px;
  }
}

  /* ===========================================
   GLOBAL RESET / IMPROVEMENTS
=========================================== */

body {
  background: #f5f7fa;
  font-family: 'Inter', sans-serif;
}

/* Removes scrollbar ugly UI */
::-webkit-scrollbar {
  width: 6px;
}
::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 10px;
}

/* ===========================================
   TOP NAVBAR
=========================================== */

.navbar {
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  padding: 12px 18px;
}

.nav-link {
  font-weight: 500;
  transition: 0.25s ease;
}

.nav-link:hover {
  color: #16a34a !important;
}

/* ===========================================
   CARDS
=========================================== */

.card {
  background: #ffffff;
  border-radius: 16px;
  box-shadow: rgba(0, 0, 0, 0.05) 0px 5px 15px;
  transition: 0.3s ease;
}

.card:hover {
  transform: translateY(-3px);
  box-shadow: rgba(0, 0, 0, 0.10) 0px 10px 22px;
}

.card-lg .card-body {
  padding: 24px;
}

.card h4 {
  font-weight: 600;
  color: #374151;
}

/* ===========================================
   WELCOME HEADER CARD
=========================================== */

.card.bg-gray-100 {
  border-radius: 20px;
  overflow: hidden;
  box-shadow: rgba(0, 0, 0, 0.08) 0px 8px 20px;
}

.card.bg-gray-100 h1 {
  font-size: 32px;
  font-weight: 700;
  color: #ffffff;
  text-shadow: 0 2px 6px rgba(0,0,0,0.4);
}

.card.bg-gray-100 p {
  color: #f1f5f9;
}

/* ===========================================
   BUTTONS
=========================================== */

.btn {
  padding: 10px 18px;
  border-radius: 8px;
  transition: 0.2s ease;
}

.btn:hover {
  transform: translateY(-2px);
}

/* ===========================================
   BEST-SELLING PRODUCT LIST
=========================================== */

#bestProductsList li {
  border-bottom: 1px solid #e5e7eb;
  background: #fff;
  border-radius: 10px;
  margin-bottom: 6px;
  transition: 0.25s ease;
}

#bestProductsList li:hover {
  background: #f9fafb;
  transform: translateX(4px);
}

/* ===========================================
   CATEGORY BOX
=========================================== */

#bestCategoryBox > div {
  background: #ffffff;
  border-radius: 12px;
  margin-bottom: 10px;
  transition: 0.2s ease;
}

#bestCategoryBox > div:hover {
  background: #f0fdf4;
}

/* ===========================================
   DATE FILTER FIELDS
=========================================== */

#dateFilterForm input[type="date"] {
  border: 1px solid #d1d5db;
  padding: 8px;
  border-radius: 6px;
  transition: 0.2s ease;
}

#dateFilterForm input[type="date"]:focus {
  border-color: #22c55e;
  outline: none;
  box-shadow: 0 0 4px rgba(34, 197, 94, 0.4);
}

/* ===========================================
   DOWNLOAD MENU BUTTON
=========================================== */

#downloadMenuBtn {
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 20px;
}

#downloadMenu {
  animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

/* ===========================================
   CHARTS
=========================================== */

canvas {
  background: #ffffff;
  padding: 12px;
  border-radius: 14px;
}

:root {
  --primary: #16a34a;
  --primary-dark: #059669;
  --bg-main: #f5f7fa;
  --sidebar-bg: #ffffff;
  --danger: #dc2626;
}


/* ===========================================
   RESPONSIVE CHANGES
=========================================== */

@media(max-width: 768px){
  h1 { font-size: 26px; }
  .card-lg .card-body { padding: 18px; }
  #topNavbar { gap: 10px; }
}

@media (max-width: 640px) {
  aside {
    transform: translateX(-100%);
    transition: 0.3s;
  }

  aside.open {
    transform: translateX(0);
  }

  main {
    margin-left: 0 !important;
    width: 100% !important;
  }
}

</style>


	<title>Dashboard </title>
</head>

<body>


<button id="menuBtn"
  class="md:hidden px-3 py-2 bg-green-600 text-white rounded">
  ‚ò∞
</button>


      <aside class="fixed top-0 left-0 h-screen w-64 bg-white shadow-lg z-40">
  
  <!-- Logo -->
  <div class="flex items-center justify-center h-16 border-b">
    <img src="../assets/images/logo/Xe mart.png" class="h-10" />
  </div>

  <!-- Menu -->
  <ul class="flex flex-col gap-2 p-4">

    <li>
      <a href="/admin/dashboard"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üè† <span>Dashboard</span>
      </a>
    </li>

    <li>
      <a href="/admin/products"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üõí <span>Products</span>
      </a>
    </li>

    <li>
      <a href="/admin/categories"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üìÇ <span>Categories</span>
      </a>
    </li>

    <li>
      <a href="/admin/customers"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üë• <span>Customers</span>
      </a>
    </li>

    <li>
      <a href="/admin/orders"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üì¶ <span>Orders</span>
      </a>
    </li>

    <li>
      <a href="/admin/coupons"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üéüÔ∏è <span>Coupons</span>
      </a>
    </li>

    <li>
      <a href="/admin/product-offer"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üí∏ <span>Product Offer</span>
      </a>
    </li>

    <li>
      <a href="/admin/category-offer"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üè∑Ô∏è <span>Category Offer</span>
      </a>
    </li>

    <li>
      <a href="/admin/sales-report"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üìä <span>Sales Report</span>
      </a>
    </li>

    <li class="mt-6">
      <a href="/admin/logout"
         class="flex items-center gap-3 p-2 rounded text-red-600 hover:bg-red-100">
        üö™ <span>Logout</span>
      </a>
    </li>

  </ul>
</aside>


		<div class="main-wrapper">
	
			<main  class="pt-6 pt-20 min-h-screen overflow-y-auto"
  style="margin-left:14rem; width:calc(100% - 16rem);">
				<section class="container">
					<!-- row -->
					<div class="grid grid-cols-12 mb-8">
						<div class="col-span-12">
							<!-- card -->
							<div class="card bg-gray-100 border-0 rounded-2xl"
								style="background-image: url(../style/1234567890.jpg); background-repeat: no-repeat; background-size: cover; background-position: right">
								<div class="card-body lg:p-12">
									<h1>Welcome back! XMART</h1>
									<p class="mb-6">FreshCart is simple & clean design for developer and designer.</p>
									<a href="products"
										class="btn inline-flex items-center gap-x-2 bg-green-600 text-white border-green-600 disabled:opacity-50 disabled:pointer-events-none hover:text-white hover:bg-green-700 hover:border-green-700 active:bg-green-700 active:border-green-700 focus:outline-none focus:ring-4 focus:ring-green-100">
										Create Product
									</a>
								</div>
							</div>
						</div>
					</div>
					<!-- table -->

					<div class="grid grid-cols-12 gap-y-8 lg:gap-x-8 mb-8">
						<div class="lg:col-span-4 col-span-12">
							<!-- card -->
							<div class="card h-full card-lg">
  <div class="card-body p-6">
    <!-- Heading -->
    <div class="flex justify-between items-center mb-6">
      <div>
        <h4 class="mb-0 text-md">Earnings</h4>
      </div>
      <div class="h-10 w-10 bg-red-100 text-red-800 rounded-full flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round"
          class="icon icon-tabler icon-tabler-outline icon-tabler-currency-dollar">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2" />
          <path d="M12 3v3m0 12v3" />
        </svg>
      </div>
    </div>

    <!-- Earnings Amount -->
    <div class="leading-snug text-center">
      <h4>Earnings: ‚Çπ<%= totalEarnings.toLocaleString('en-IN') %> (Monthly)</h4>
      <span class="text-sm text-gray-500">Monthly revenue (Delivered Orders Only)</span>
    </div>
  </div>
</div>

						</div>
							<div class="lg:col-span-4 col-span-12">
							<!-- card -->
							<div class="card h-full card-lg">
								<!-- card body -->
								<div class="card-body p-6">
									<!-- heading -->
									<div class="flex justify-between items-center mb-6">
										<div>
											<h4 class="mb-0 text-md">Grand Total</h4>
										</div>
									    <div class="h-10 w-10 bg-red-100 text-red-800 rounded-full flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round"
          class="icon icon-tabler icon-tabler-outline icon-tabler-currency-dollar">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2" />
          <path d="M12 3v3m0 12v3" />
        </svg>
      </div>
									</div>
									<!-- project number -->
									<%
  const ttt = lasttotal.reduce((a,b)=>a+(b.grandTotal||0),0);
%>

									<div class="leading-snug">
										<h4>Overall Order Amount : <%= ttt %></h4>
										
									</div>
								</div>
							</div>
						</div>
						<div class="lg:col-span-4 col-span-12">
							<!-- card -->
							<div class="card h-full card-lg">
								<!-- card body -->
								<div class="card-body p-6">
  <!-- Heading -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h4 class="mb-0 text-md">Orders To Ship</h4>
    </div>
    <div class="h-10 w-10 bg-yellow-100 text-yellow-800 rounded-full flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round"
        class="icon icon-tabler icon-tabler-outline icon-tabler-shopping-cart">
        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
        <path d="M6 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
        <path d="M17 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
        <path d="M17 17h-11v-14h-2" />
        <path d="M6 5l14 1l-1 7h-13" />
      </svg>
    </div>
  </div>

  <!-- Orders Count -->
  <div class="leading-snug text-center">
  <h1 class="mb-2 font-bold text-lg"><%= totalOrders %></h1>
  <span class="text-sm text-gray-500">Total Orders</span>
</div>
</div>

							</div>
						</div>
						<div class="lg:col-span-4 col-span-12">
							<!-- card -->
					<div class="card h-full card-lg">
  <div class="card-body p-6">
    <!-- heading -->
    <div class="flex justify-between items-center mb-6">
      <div>
        <h4 class="mb-0 text-md">Orders </h4>
      </div>
      <div
        class="h-10 w-10 bg-green-100 text-green-800 rounded-full flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-shopping-cart">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M6 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
          <path d="M17 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
          <path d="M17 17h-11v-14h-2" />
          <path d="M6 5l14 1l-1 7h-13" />
        </svg>
      </div>
    </div>
    <!-- project number -->
    <div class="leading-snug">
      <ul>
  <li>Delivered: <%= ordersByStatus.Delivered %></li>
  <li>Pending: <%= ordersByStatus.Pending %></li>
  <li>Cancelled: <%= ordersByStatus.Cancelled %></li>
  <li>Returned: <%= ordersByStatus.Returned %></li>
</ul>
    </div>
  </div>
</div>

						</div>
						<div class="lg:col-span-4 col-span-12">
							<!-- card -->
							<div class="card h-full card-lg">
								<!-- card body -->
								<div class="card-body p-6">
									<!-- heading -->
									<div class="flex justify-between items-center mb-6">
										<div>
											<h4 class="mb-0 text-md">Customer</h4>
										</div>
										<div
											class="h-10 w-10 bg-cyan-100 text-cyan-800 rounded-full flex items-center justify-center">
											<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
												viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
												stroke-linecap="round" stroke-linejoin="round"
												class="icon icon-tabler icons-tabler-outline icon-tabler-users">
												<path stroke="none" d="M0 0h24v24H0z" fill="none" />
												<path d="M9 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
												<path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
												<path d="M16 3.13a4 4 0 0 1 0 7.75" />
												<path d="M21 21v-2a4 4 0 0 0 -3 -3.85" />
											</svg>
										</div>
									</div>
									<!-- project number -->
									<div class="leading-snug">
										<h4>Total Users: <%= totalUsers %></h4>
										
									</div>
								</div>
							</div>
						</div>
						
					</div>

					<!-- row -->

<div class="grid grid-cols-12 gap-y-8 lg:gap-x-8 mb-8">

  <!-- Revenue Card -->
  <div class="xl:col-span-8 lg:col-span-6 md:col-span-12 col-span-12">
    <div class="card h-full card-lg">
      <div class="card-body p-6">
        <div class="flex justify-between items-center">
          <h3 class="mb-1 text-md font-semibold">Revenue</h3>
          <select id="revenueFilter" class="text-base py-2 block w-40 border-gray-300 rounded-lg focus:border-green-600 focus:ring focus:ring-green-600">
            <option value="week" selected>Week</option>
            <option value="month">Month</option>
            <option value="year">Year</option>
          </select>
        </div>

        <!-- <div class="flex gap-2 mt-3"> -->
			
          <!-- <button id="downloadRevenue" class="px-3 py-1.5 bg-blue-600 text-white rounded-md">Download Revenue Chart</button> -->
        <!-- </div> -->
<div class="relative inline-block text-left">
  <button id="downloadMenuBtn" 
    class="px-3 py-1.5 bg-blue-600 text-white rounded-md">
    ‚ãÆ
  </button>

  <div id="downloadMenu" 
       class="hidden absolute right-0 mt-2 w-40 bg-white shadow-lg rounded-md border z-50">
    <button class="block px-4 py-2 w-full text-left hover:bg-gray-100" data-type="png">
      Download PNG
    </button>
    <!-- <button class="block px-4 py-2 w-full text-left hover:bg-gray-100" data-type="pdf">
      Download PDF
    </button> -->
  </div>
</div>

        <!-- <form id="date-wise-filter" class="flex gap-2 mt-3">
          <input type="date" id="startDate" class="border rounded px-2 py-1" />
          <input type="date" id="endDate" class="border rounded px-2 py-1" />
          <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded">Apply</button>
        </form> -->
		<form id="dateFilterForm" class="flex gap-2 mt-3">
  <input type="date" id="startDate" class="border rounded px-2 py-1" />
  <input type="date" id="endDate" class="border rounded px-2 py-1" />
  <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded">Apply</button>
</form>


        <canvas id="revenueChart" class="mt-6 h-64"></canvas>
      </div>
    </div>
  </div>

  <!-- Total Orders Card -->
<div class="xl:col-span-4 lg:col-span-6 col-span-12">
  <div class="card h-full card-lg">
    <div class="card-body p-6">
      <h3 class="mb-3 text-md font-semibold">Total Orders</h3>
      <!-- <select id="ordersFilter" class="text-base py-2 block w-full border-gray-300 rounded-lg focus:border-green-600 focus:ring focus:ring-green-600 mb-4">
        <option value="week" selected>Week</option>
        <option value="month">Month</option>
        <option value="year">Year</option>
      </select> -->

      <canvas id="ordersChart" class="h-64"></canvas>

      <ul class="mt-4 space-y-2 text-sm">
        <li class="flex items-center gap-2"><span class="w-3 h-3 bg-green-600 rounded-full"></span> Delivered: <%= ordersByStatus.Delivered %></li>
        <li class="flex items-center gap-2"><span class="w-3 h-3 bg-red-600 rounded-full"></span> Returned: <%= ordersByStatus.Returned %></li>
        <li class="flex items-center gap-2"><span class="w-3 h-3 bg-blue-600 rounded-full"></span> Cancelled: <%= ordersByStatus.Cancelled %></li>
        <li class="flex items-center gap-2"><span class="w-3 h-3 bg-yellow-600 rounded-full"></span> Pending: <%= ordersByStatus.Pending %></li>
      </ul>
    </div>
  </div>
</div>


</div>







					<!-- row -->
					<div class="grid lg:grid-cols-2 gap-8 mb-8">
						<div class="">
							<!-- card -->
		 <div class="mt-4">
          <h3 class="font-semibold">Top Selling (Delivered)</h3>
          <ul id="bestProductsList" class="mt-2 divide-y">
            <!-- JS inserts items -->
          </ul>
        </div>
						</div>
						<div class="">
							<div class="position-relative h-full">
								<!-- card -->
<div class="bg-white mt-4 p-4 rounded shadow">
  <h3 class="font-semibold text-lg mb-2">Top Selling Categories</h3>
  <div id="bestCategoryBox"></div>
</div>



								<!-- card -->
								
							</div>
						</div>
					</div>
					<!-- row -->
					
				</section>
			</main>
		</div>
	</div>

	<!-- Libs JS -->
<script src="../assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="../assets/libs/simplebar/dist/simplebar.min.js"></script>

<!-- Theme JS -->

<script src="../assets/js/theme.min.js"></script>

	<script src="../assets/libs/apexcharts/dist/apexcharts.min.js"></script>
	<script src="../assets/js/vendors/chart.js"></script>


<!-- Chart.js CDN -->
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
  const today = new Date().toISOString().split("T")[0];

  // disable future dates
  document.getElementById("startDate").setAttribute("max", today);
  document.getElementById("endDate").setAttribute("max", today);

	const $ = id => document.getElementById(id);



  function updateBestSellingProducts(listData) {
    const ul = $('bestProductsList');
    ul.innerHTML = '';
    if (!listData || listData.length === 0) {
      ul.innerHTML = '<li class="p-3 text-gray-500">No products sold in this range.</li>';
      return;
    }
    listData.forEach(item => {
      const imgSrc = item.productImg || '/images/placeholder.png';
      const li = document.createElement('li');
      li.className = 'flex items-center gap-3 p-3';
      li.innerHTML = `
        <img src="${imgSrc}" alt="${item.name}" class="w-14 h-14 object-cover rounded border" />
        <div class="flex-1">
          <div class="font-semibold">${item.name}</div>
          <div class="text-sm text-gray-600">Size: ${item.selectedSize} ‚Ä¢ ‚Çπ${item.price}</div>
        </div>
        <div class="font-bold text-green-600">Sold: ${item.totalSold}</div>
      `;
      ul.appendChild(li);
    });
  }

  function initCharts(data) {
    const rCtx = $('revenueChart').getContext('2d');
    revenueChart = new Chart(rCtx, {
      type: 'line',
      data: {
        labels: data.labels,
        datasets: [{
          label: 'Revenue',
          data: data.revenuePerDay,
          borderColor: '#22c55e',
          backgroundColor: 'rgba(34,197,94,0.2)',
          fill: true,
          tension: 0.3
        }]
      },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    const oCtx = $('ordersChart').getContext('2d');
    ordersChart = new Chart(oCtx, {
      type: 'doughnut',
      data: {
        labels: ['Delivered','Returned','Cancelled','Pending'],
        datasets: [{
          data: [
            data.ordersByStatus.Delivered || 0,
            data.ordersByStatus.Returned || 0,
            data.ordersByStatus.Cancelled || 0,
            data.ordersByStatus.Pending || 0
          ],
          backgroundColor: ['#22c55e','#ef4444','#3b82f6','#facc15'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        cutout: "70%",
        plugins: { legend: { position: 'bottom' }, centerText: { text: (data.ordersByStatus.Delivered || 0).toString() } }
      },
      plugins: [centerTextPlugin]
    });

    updateBestSellingProducts(data.bestSellingProducts);
  }

  function updateChartsOnData(data) {
    if (!revenueChart) { initCharts(data); return; }

    revenueChart.data.labels = data.labels;
    revenueChart.data.datasets[0].data = data.revenuePerDay;
    revenueChart.update();

    ordersChart.data.datasets[0].data = [
      data.ordersByStatus.Delivered || 0,
      data.ordersByStatus.Returned || 0,
      data.ordersByStatus.Cancelled || 0,
      data.ordersByStatus.Pending || 0
    ];
    ordersChart.options.plugins.centerText.text = (data.ordersByStatus.Delivered || 0).toString();
    ordersChart.update();

    updateBestSellingProducts(data.bestSellingProducts);
  }

  // download menu
  $('downloadMenuBtn').addEventListener('click', () => $('downloadMenu').classList.toggle('hidden'));
  document.addEventListener('click', (e) => {
    if (!$('downloadMenu').contains(e.target) && !$('downloadMenuBtn').contains(e.target)) {
      $('downloadMenu').classList.add('hidden');
    }
  });
  $('downloadMenu').querySelectorAll('button').forEach(btn => {
    btn.addEventListener('click', () => {
      const type = btn.dataset.type;
      if (!revenueChart) return alert('Chart not ready');
      if (type === 'png') {
        const link = document.createElement('a');
        link.href = revenueChart.toBase64Image();
        link.download = 'RevenueChart.png';
        link.click();
      } else if (type === 'pdf') {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('landscape');
        const img = revenueChart.toBase64Image();
        pdf.setFontSize(18);
        pdf.text('Revenue Chart', 14, 20);
        pdf.addImage(img, 'PNG', 10, 30, 270, 120);
        pdf.save('RevenueChart.pdf');
      }
      $('downloadMenu').classList.add('hidden');
    });
  });

  async function fetchSummary(params = {}) {
    const qs = new URLSearchParams(params).toString();
    const url = `/admin/orders-summary${qs ? '?' + qs : ''}`;
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error('Network response not ok');
      const data = await res.json();
      updateChartsOnData(data);
    } catch (err) {
      console.error('Fetch error', err);
      alert('Failed to load dashboard data. Check console.');
    }
  }

  // initial load
  fetchSummary();

  // timeframe change
  $('revenueFilter').addEventListener('change', () => {
    $('startDate').value = '';
    $('endDate').value = '';
    fetchSummary({ timeframe: $('revenueFilter').value });
  });

  // date form
  $('dateFilterForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const s = $('startDate').value;
    const eD = $('endDate').value;
    if (!s || !eD) return alert('Please pick start & end date');
    fetchSummary({ start: s, end: eD });
  });
// --------------------------------------------------
// CENTER TEXT PLUGIN FOR DOUGHNUT
// --------------------------------------------------
const centerTextPlugin = {
  id: "centerText",
  beforeDraw(chart, args, options) {
    const { ctx, chartArea } = chart;
    if (!chartArea) return;

    const width = chartArea.width;
    const height = chartArea.height;

    ctx.save();
    ctx.font = "bold 26px sans-serif";
    ctx.fillStyle = "#000";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(options.text, width / 2, height / 2);
    ctx.restore();
  }
};



function updateBestSellingCategory(data) {
  const box = document.getElementById("bestCategoryBox");
  box.innerHTML = "";

  if (!data || data.length === 0) {
    box.innerHTML = `<div class="p-3 text-gray-500">No category data</div>`;
    return;
  }

  data.forEach(cat => {
    box.innerHTML += `
      <div class="flex items-center gap-3 p-3 border-b">
        <img src="${cat.categoryImage || '/images/placeholder.png'}"
             class="w-12 h-12 rounded object-cover border" />

        <div class="flex-1">
          <p class="font-semibold">${cat.categoryName}</p>
          <p class="text-sm text-gray-600">Sold: ${cat.totalSold}</p>
        </div>
      </div>
    `;
  });
}

function updateChartsOnData(data) {

  revenueChart.data.labels = data.labels;
  revenueChart.data.datasets[0].data = data.revenuePerDay;
  revenueChart.update();

  ordersChart.data.datasets[0].data = [
    data.ordersByStatus.Delivered,
    data.ordersByStatus.Returned,
    data.ordersByStatus.Cancelled,
    data.ordersByStatus.Pending
  ];
  ordersChart.options.plugins.centerText.text = data.ordersByStatus.Delivered;
  ordersChart.update();

  updateBestSellingProducts(data.bestSellingProducts);  
  updateBestSellingCategory(data.bestSellingCategory);  
}




// --------------------------------------------------
// DROPDOWN DOWNLOAD MENU
// --------------------------------------------------
const menuBtn = document.getElementById("downloadMenuBtn");
const menu = document.getElementById("downloadMenu");

menuBtn.addEventListener("click", () => {
  menu.classList.toggle("hidden");
});

document.addEventListener("click", (e) => {
  if (!menu.contains(e.target) && !menuBtn.contains(e.target)) {
    menu.classList.add("hidden");
  }
});

menu.querySelectorAll("button").forEach(btn => {
  btn.addEventListener("click", () => {
    const type = btn.dataset.type;

    if (type === "png") {
      const link = document.createElement('a');
      link.href = revenueChart.toBase64Image();
      link.download = 'RevenueChart.png';
      link.click();
    }

    if (type === "pdf") {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF("landscape");
      const img = revenueChart.toBase64Image();

      pdf.setFontSize(18);
      pdf.text("Revenue Chart", 14, 20);
      pdf.addImage(img, "PNG", 10, 30, 270, 120);

      pdf.save("RevenueChart.pdf");
    }

    menu.classList.add("hidden");
  });
});


// --------------------------------------------------
// BACKEND DATA FROM EJS
// --------------------------------------------------
const labels = JSON.parse('<%- JSON.stringify(labels || []) %>');
const revenueData = JSON.parse('<%- JSON.stringify(revenuePerDay || []) %>');
const ordersData = JSON.parse('<%- JSON.stringify(ordersByStatus || {}) %>');


// --------------------------------------------------
// REVENUE CHART
// --------------------------------------------------
const revenueCtx = document.getElementById('revenueChart').getContext('2d');

const revenueChart = new Chart(revenueCtx, {
  type: 'line',
  data: {
    labels,
    datasets: [{
      label: 'Revenue',
      data: revenueData,
      borderColor: '#22c55e',
      backgroundColor: 'rgba(34,197,94,0.2)',
      fill: true,
      tension: 0.3
    }]
  },
  options: {
    responsive: true,
    scales: { y: { beginAtZero: true } }
  }
});


// --------------------------------------------------
// ORDERS DOUGHNUT CHART
// --------------------------------------------------
const ordersCtx = document.getElementById('ordersChart').getContext('2d');

const ordersChart = new Chart(ordersCtx, {
  type: 'doughnut',
  data: {
    labels: ['Delivered', 'Returned', 'Cancelled', 'Pending'],
    datasets: [{
      data: [
        ordersData.Delivered || 0,
        ordersData.Returned || 0,
        ordersData.Cancelled || 0,
        ordersData.Pending || 0
      ],
      backgroundColor: ['#22c55e','#ef4444','#3b82f6','#facc15'],
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    cutout: "70%",
    plugins: {
      legend: { position: 'bottom' },
      tooltip: { enabled: true },
      centerText: {
        text: (ordersData.Delivered || 0).toString()
      }
    }
  },
  plugins: [centerTextPlugin]
});


// --------------------------------------------------
// ‚úî FUNCTION TO UPDATE ORDERS CHART DYNAMICALLY
// --------------------------------------------------
function updateOrdersChart(newData) {
  ordersChart.data.datasets[0].data = [
    newData.Delivered,
    newData.Returned,
    newData.Cancelled,
    newData.Pending
  ];

  ordersChart.options.plugins.centerText.text =
    newData.Delivered.toString();

  ordersChart.update();
}


// --------------------------------------------------
// TIMEFRAME FILTER UPDATE (Daily, Monthly, Weekly)
// --------------------------------------------------
document.getElementById('revenueFilter').addEventListener('change', updateCharts);

async function updateCharts() {
  const timeframe = document.getElementById('revenueFilter').value;

  try {
    const res = await fetch(`/admin/orders-summary?timeframe=${timeframe}`);
    const data = await res.json();

    revenueChart.data.labels = data.labels;
    revenueChart.data.datasets[0].data = data.revenuePerDay;
    revenueChart.update();

    updateOrdersChart(data.ordersByStatus);

  } catch (err) {
    console.error("Error Updating Chart:", err);
  }
}

const menuBt = document.getElementById("menuBtn");
const sidebar = document.querySelector("aside");

menuBt.onclick = () => {
  sidebar.classList.toggle("open");
};

// --------------------------------------------------
// DATE FILTER UPDATE (Start - End)
// --------------------------------------------------
document.getElementById('dateFilterForm')?.addEventListener("submit", async (e) => {
  e.preventDefault();

  const start = document.getElementById("startDate").value;
  const end = document.getElementById("endDate").value;

  if (!start || !end) {
    alert("Please select both dates");
    return;
  }

  const res = await fetch(`/admin/orders-summary?start=${start}&end=${end}`);
  const data = await res.json();

  revenueChart.data.labels = data.labels;
  revenueChart.data.datasets[0].data = data.revenuePerDay;
  revenueChart.update();

  updateOrdersChart(data.ordersByStatus);
});

</script>



</body>


<!-- Mirrored from freshcart-tailwind.codescandy.com/dashboard/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Dec 2024 13:19:25 GMT -->
</html>