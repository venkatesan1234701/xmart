<!doctype html>
<html lang="en">


<!-- Mirrored from freshcart-tailwind.codescandy.com/dashboard/products.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Dec 2024 13:19:36 GMT -->
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="../assets/images/favicon/favicon.ico" />

<!-- Libs CSS -->
<link rel="preconnect" href="https://fonts.googleapis.com/" />
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" />
<link rel="stylesheet" href="../../cdn.jsdelivr.net/npm/%40tabler/icons-webfont%402.46.0/tabler-icons.min.css" />
<link rel="stylesheet" href="../assets/libs/simplebar/dist/simplebar.min.css" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.css">


<!-- Cropper.js CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />

<!-- Cropper.js JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Theme CSS -->
<link rel="stylesheet" href="../assets/css/theme.min.css">


<style>
  /* =====================================================
   PRODUCTS PAGE ‚Äì FINAL RESPONSIVE FIX
   (CSS ONLY | SAFE | NO HTML CHANGE)
===================================================== */

body {
  overflow-x: hidden;
}

/* ================= SIDEBAR (MOBILE) ================= */
@media (max-width: 768px) {
  aside {
    transform: translateX(-100%);
    transition: 0.3s ease;
    z-index: 60;
  }

  aside.open {
    transform: translateX(0);
  }

  #menuBtn {
    position: fixed;
    top: 12px;
    left: 12px;
    z-index: 100;
  }

  main {
    margin-left: 0 !important;
    width: 100% !important;
    padding-top: 70px !important;
  }
}

/* ================= PAGE HEADER ================= */
@media (max-width: 640px) {
  h2 {
    font-size: 18px;
  }
}

/* ================= SEARCH BAR ================= */
@media (max-width: 640px) {
  #productsSearchForm {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }

  #productsSearchForm .relative {
    width: 100%;
  }

  #productsSearchForm button {
    width: 100%;
  }
}

/* ================= ADD PRODUCT BUTTON ================= */
@media (max-width: 640px) {
  #addProductBtn {
    width: 100%;
    margin-bottom: 10px;
  }
}

/* ================= TABLE WRAPPER ================= */
.bg-white.rounded-lg.shadow-md {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* ================= TABLE BASE ================= */
table {
  width: 100%;
  min-width: 900px;
  border-collapse: collapse;
}

/* ================= TABLE CELLS ================= */
thead th,
tbody td {
  white-space: nowrap;
  vertical-align: middle;
  font-size: 14px;
}

/* Product Name Column */
td:first-child {
  min-width: 200px;
  white-space: normal;
  word-break: break-word;
}

/* Image Column */
td:nth-child(3) {
  min-width: 120px;
}

/* Action Column */
td:last-child {
  min-width: 220px;
}

/* ================= ACTION BUTTONS ================= */
.editBtn,
.detailsBtn,
button {
  white-space: nowrap;
}

/* ================= MOBILE CARD VIEW ================= */
@media (max-width: 576px) {
  table {
    min-width: 850px;
  }

  thead {
    display: none;
  }

  tbody tr {
    display: block;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    margin-bottom: 12px;
    padding: 10px;
  }

  tbody td {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 4px;
    text-align: left !important;
  }

  tbody td::before {
    content: attr(data-label);
    font-weight: 600;
    color: #6b7280;
    padding-right: 10px;
  }

  tbody td:last-child {
    justify-content: flex-end;
  }
}

/* ================= ADD / EDIT MODAL ================= */
@media (max-width: 640px) {
  #addProductModal > div,
  #cropModal > div {
    max-width: 95%;
    padding: 12px;
  }

  .size-row {
    flex-wrap: wrap;
    gap: 6px;
  }

  .sizePrice,
  .sizeQty {
    width: 100%;
  }
}

/* ================= DETAILS MODAL ================= */
@media (max-width: 640px) {
  #detailsModal .modal-box {
    width: 95%;
    padding: 14px;
  }

  #detailsImages img {
    width: 80px;
    height: 80px;
  }
}

/* ================= PAGINATION ================= */
@media (max-width: 640px) {
  nav.flex.items-center.gap-x-1 {
    flex-wrap: wrap;
    justify-content: center;
    gap: 6px;
  }
}

  /* ==========================================================
   GLOBAL PAGE STYLING
========================================================== */
body {
  background: #f5f7fa;
  font-family: "Inter", sans-serif;
}


@media (max-width: 640px) {
  aside {
    transform: translateX(-100%);
    transition: 0.3s;
  }

  aside.open {
    transform: translateX(0);
  }

  main {
    margin-left: 0 !important;
    width: 100% !important;
  }
}

/* Page title */
h2 {
  font-weight: 700;
  color: #1f2937;
}

/* Breadcrumb */
.breadcrumb a {
  color: #16a34a;
  font-weight: 500;
}

/* ==========================================================
   NAVBAR
========================================================== */
.navbar {
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  padding: 12px 18px;
}

.nav-link {
  font-weight: 500;
  transition: 0.25s ease;
}

.nav-link:hover {
  color: #16a34a !important;
}

/* ==========================================================
   SEARCH BAR
========================================================== */
#searchInput {
  border-radius: 10px !important;
  border: 1px solid #d1d5db !important;
  transition: 0.25s ease;
}

#searchInput:focus {
  border-color: #22c55e !important;
  box-shadow: 0 0 6px rgba(34,197,94,0.4);
}

#clearSearch {
  cursor: pointer;
  transition: 0.2s ease;
}

#clearSearch:hover {
  color: #111827;
}

/* Search button */
#productsSearchForm button {
  border-radius: 10px;
  transition: 0.25s ease;
}

#productsSearchForm button:hover {
  transform: translateY(-2px);
  background: #059669 !important;
}

/* ==========================================================
   ADD PRODUCT BUTTON
========================================================== */
#addProductBtn {
  border-radius: 8px;
  font-weight: 600;
  transition: 0.25s ease;
}

#addProductBtn:hover {
  transform: translateY(-2px);
}

/* ==========================================================
   TABLE DESIGN
========================================================== */
table {
  border-radius: 12px !important;
  overflow: hidden;
}

thead {
  background: #e8f5e9 !important;
}

table th {
  font-weight: 600;
  padding: 12px 10px;
  font-size: 14px;
}

table tbody tr {
  transition: 0.25s ease;
  background: #fff;
}

table tbody tr:hover {
  background: #f3f4f6;
  transform: translateX(3px);
}

table td {
  padding: 14px 12px !important;
}

/* ==========================================================
   ACTION BUTTONS
========================================================== */
.editBtn {
  background: #2563eb;
  border-radius: 7px;
  transition: 0.25s ease;
}

.editBtn:hover {
  background: #1e40af;
  transform: translateY(-2px);
}

.delete-btn, .deleteBtn {
  background: #dc2626 !important;
  border-radius: 7px;
  transition: 0.25s ease;
}

.deleteBtn:hover {
  background: #b91c1c !important;
  transform: translateY(-2px);
}

.detailsBtn {
  background: #4b5563;
  border-radius: 7px;
}

.detailsBtn:hover {
  background: #374151;
  transform: translateY(-2px);
}

/* ==========================================================
   PRODUCT IMAGE BOX
========================================================== */
.product-image-box {
  width: 80px;
  height: 80px;
  border-radius: 8px;
  overflow: hidden;
  border: 1px solid #e5e7eb;
}

/* ==========================================================
   ADD PRODUCT MODAL
========================================================== */
#addProductModal, #editProductModal, #cropModal {
  backdrop-filter: blur(3px);
}

.modal-content {
  border-radius: 14px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.15);
}

#modalTitle {
  font-weight: 700;
  color: #1f2937;
}

.form-control, .form-select {
  border-radius: 8px;
  transition: 0.3s ease;
}

.form-control:focus, .form-select:focus {
  border-color: #22c55e !important;
  box-shadow: 0 0 6px rgba(34,197,94,0.4);
}

/* Image preview slots */
.imageInputBox {
  border: 2px dashed #9ca3af;
  border-radius: 10px;
  transition: 0.3s ease;
}

.imageInputBox:hover {
  border-color: #22c55e;
}

/* Remove X */
.removeX {
  background: #dc2626;
  color: white;
  border-radius: 50%;
  font-size: 10px;
  width: 16px;
  height: 16px;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ==========================================================
   SIZE ROW
========================================================== */
.size-row {
  background: #f8fafc;
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.sizePrice, .sizeQty {
  border-radius: 6px;
  width: 70px;
}

/* Remove Button */
.removeSizeBtn {
  color: #dc2626;
  cursor: pointer;
  font-weight: 600;
}

.removeSizeBtn:hover {
  text-decoration: underline;
}

/* ==========================================================
   DETAILS MODAL
========================================================== */
#detailsModal .modal-box {
  background: white;
  padding: 20px;
  border-radius: 14px;
  width: 90%;
  max-width: 480px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.15);
}

#detailsImages img {
  border-radius: 8px;
  border: 1px solid #d1d5db;
}

/* ==========================================================
   PAGINATION
========================================================== */
.pagination button {
  border-radius: 8px !important;
  transition: 0.2s ease;
}

.pagination button:hover {
  background: #e5e7eb !important;
}

.pagination .active {
  background: #16a34a !important;
  border-color: #16a34a !important;
  color: white !important;
}

/* ==========================================================
   RESPONSIVE TABLE (Mobile)
========================================================== */
@media (max-width: 768px) {

  table thead {
    display: none;
  }

  table tbody tr {
    display: block;
    padding: 12px;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    margin-bottom: 10px;
  }

  table td {
    display: flex;
    justify-content: space-between;
    padding: 8px 5px;
  }

  table td::before {
    content: attr(data-label);
    font-weight: 600;
    color: #6b7280;
  }
}

</style>


	<title>product </title>
</head>

<body>


  
<button id="menuBtn"
  class="md:hidden px-3 py-2 bg-green-600 text-white rounded">
  ‚ò∞
</button>



    <aside class="fixed top-0 left-0 h-screen w-64 bg-white shadow-lg z-40">
  
  <!-- Logo -->
  <div class="flex items-center justify-center h-16 border-b">
    <img src="../assets/images/logo/Xe mart.png" class="h-10" />
  </div>

  <!-- Menu -->
  <ul class="flex flex-col gap-2 p-4">

    <li>
      <a href="/admin/dashboard"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üè† <span>Dashboard</span>
      </a>
    </li>

    <li>
      <a href="/admin/products"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üõí <span>Products</span>
      </a>
    </li>

    <li>
      <a href="/admin/categories"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üìÇ <span>Categories</span>
      </a>
    </li>

    <li>
      <a href="/admin/customers"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üë• <span>Customers</span>
      </a>
    </li>

    <li>
      <a href="/admin/orders"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üì¶ <span>Orders</span>
      </a>
    </li>

    <li>
      <a href="/admin/coupons"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üéüÔ∏è <span>Coupons</span>
      </a>
    </li>

    <li>
      <a href="/admin/product-offer"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üí∏ <span>Product Offer</span>
      </a>
    </li>

    <li>
      <a href="/admin/category-offer"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üè∑Ô∏è <span>Category Offer</span>
      </a>
    </li>

    <li>
      <a href="/admin/sales-report"
         class="flex items-center gap-3 p-2 rounded hover:bg-green-100 text-gray-700">
        üìä <span>Sales Report</span>
      </a>
    </li>

    <li class="mt-6">
      <a href="/admin/logout"
         class="flex items-center gap-3 p-2 rounded text-red-600 hover:bg-red-100">
        üö™ <span>Logout</span>
      </a>
    </li>

  </ul>
</aside>


		<div class="main-wrapper">
	
			<!-- main -->
			<main class="pt-6 pt-20 min-h-screen overflow-y-auto"
  style="margin-left:14rem; width:calc(100% - 16rem);">
				<div >
					<div class="grid grid-cols-1 mb-2">
						<!-- page header -->
						<div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
							<div>
								<h2 class="text-xl">Products</h2>
								<!-- breacrumb -->
								<nav aria-label="breadcrumb">
									<ol class="flex flex-wrap">
										<li class="inline-block text-green-600">
											<a href="#!">
												Dashboard
												<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14"
													viewBox="0 0 24 24" fill="none" stroke="currentColor"
													stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
													class="icon icon-tabler icons-tabler-outline icon-tabler-slash inline-block mx-2">
													<path stroke="none" d="M0 0h24v24H0z" fill="none" />
													<path d="M17 5l-10 14" />
												</svg>
											</a>
										</li>

										<li class="inline-block text-gray-500 active" aria-current="page">Products</li>
									</ol>
								</nav>
							</div>
							<!-- button -->
							<div>


<form id="productsSearchForm" class="flex items-center justify-end mb-4" role="search">
  <div class="relative w-64">
    <input 
      type="text" 
      id="searchInput" 
      placeholder="Search products..." 
      class="border px-3 py-2 rounded w-full focus:ring-2 focus:ring-green-500 focus:outline-none pr-8"
      autocomplete="off"
    />

    <!-- ‚ùå inside input -->
    <button 
      type="button" 
      id="clearSearch" 
      class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <button 
    type="submit" 
    class="ml-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
  >
    Search
  </button>
</form>





							</div>
						</div>
					</div>
					
					<!-- row -->
					<div class="grid grid-cols-1">


  <!-- card -->
  

  

<button id="addProductBtn" class="px-1 py-2 text-xs bg-green-600 text-white rounded hover:bg-green-700 w-24">
  Add Product
</button>


<!-- Add Product Modal -->




<!-- Add Product Modal -->







<!-- ===== Add Product Modal ===== -->








<!-- Add Product Modal -->



<div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-start justify-center pt-32">
  <div class="bg-white rounded-lg shadow-md w-full max-w-lg p-4 max-h-[90vh] flex flex-col overflow-hidden">
    <div class="overflow-y-auto">
      <h2 id="modalTitle" class="text-lg font-bold mb-4">Add Product</h2>

      <form id="productForm" action="/admin/products/add" method="POST" enctype="multipart/form-data" class="space-y-3">

        <!-- Category + Name + Add Variant Btn -->
        <div class="flex gap-2 mb-3 items-end">
         <div class="flex-1">
  <label>Category</label>
  <select id="category" name="category" class="w-full border rounded px-3 py-2 text-sm">
    <option value="">-- Select Category --</option>
    <% categories.forEach(cat => { %>
      <% if (!cat.isDeleted) { %> 
        <option value="<%= cat._id %>"><%= cat.name %></option>
      <% } %>
    <% }) %>
  </select>
</div>


          <div class="flex-1">
            <label>Product Name</label>
            <input type="text" id="productName" name="name" class="w-full border rounded px-3 py-2 text-sm" placeholder="Enter product name" >
          </div>

          <div class="flex-shrink-0">
           
          </div>
          <div class="flex flex-col gap-2">

</div>
<div class="size-row flex items-center gap-2">
  <input type="checkbox" class="size-checkbox" value="S">
  <label>S</label>
  <input type="number" class="sizePrice border p-1 w-20" placeholder="Price">
  <input type="number" class="sizeQty border p-1 w-20" placeholder="Qty">
  <!-- <button type="button" class="removeSizeBtn text-red-500">Remove</button> -->
</div>

<div class="size-row flex items-center gap-2">
  <input type="checkbox" class="size-checkbox" value="M">
  <label>M</label>
  <input type="number" class="sizePrice border p-1 w-20" placeholder="Price">
  <input type="number" class="sizeQty border p-1 w-20" placeholder="Qty">
  <!-- <button type="button" class="removeSizeBtn text-red-500">Remove</button> -->
</div>

<div class="size-row flex items-center gap-2">
  <input type="checkbox" class="size-checkbox" value="L">
  <label>L</label>
  <input type="number" class="sizePrice border p-1 w-20" placeholder="Price">
  <input type="number" class="sizeQty border p-1 w-20" placeholder="Qty">
  <!-- <button type="button" class="removeSizeBtn text-red-500">Remove</button> -->
</div>


        </div>

        <!-- Variant Input Area -->
        
        <input type="hidden" name="variants" id="variantsInput">

        <!-- Description -->
        <div class="mb-3">
          <label>Description</label>
          <textarea id="description" name="description" class="w-full border rounded px-3 py-2 text-sm" rows="3" placeholder="Enter product description"></textarea>
        </div>

        <!-- Images -->
        <div class="flex gap-3 items-end mb-3">
          <% for (let i = 0; i < 3; i++) { %>
            <div class="relative w-20 h-20">
              <label class="w-full h-full flex items-center justify-center border-2 border-dashed rounded cursor-pointer overflow-hidden relative">
                <span class="text-green-500 text-2xl absolute inset-0 flex items-center justify-center pointer-events-none" id="plus<%= i %>">+</span>
                <img id="preview<%= i %>" class="rounded object-cover border hidden absolute inset-0 w-full h-full" alt="Preview">
                <span class="removeX hidden absolute top-1 right-1 text-white bg-red-600 rounded-full w-4 h-4 text-xs flex items-center justify-center cursor-pointer pointer-events-auto" data-preview="preview<%= i %>">√ó</span>
                <input type="file" name="image<%= i %>" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer imageInput" data-preview="preview<%= i %>" accept="image/*">
              </label>
            </div>
          <% } %>
        </div>

        <p id="errorMsg" class="text-red-500 text-sm mb-2 hidden"></p>

        <!-- Buttons -->
        <div class="flex justify-end gap-2 mt-2">
          <button type="button" id="closeModal" class="px-3 py-2 rounded bg-gray-200 hover:bg-gray-300">Cancel</button>
          <button type="submit" id="saveBtn" class="px-3 py-2 rounded bg-green-600 text-white hover:bg-green-700">Save</button>
        </div>

      </form>
    </div>
  </div>
</div>





<!-- ================= Edit Product Modal ================= -->

<!-- Modal -->
















<!-- Crop Modal -->



<!-- Crop Modal -->






<div id="cropModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-start justify-center p-4">
  <div class="bg-white rounded-lg shadow-md w-full max-w-lg p-6 max-h-[90vh] flex flex-col overflow-hidden">
    <div class="overflow-y-auto">
      <h2 class="text-lg font-bold mb-4">Crop Image</h2>
      <img id="cropImage" class="w-full object-contain mb-4" />
      <div class="flex justify-end gap-2">
        <button id="cancelCrop" class="px-3 py-2 rounded bg-gray-200 text-sm hover:bg-gray-300">Cancel</button>
        <button id="applyCrop" class="px-3 py-2 rounded bg-green-600 text-white text-sm hover:bg-green-700">Apply</button>
      </div>
    </div>
  </div>
</div>







							<!-- card body -->
<body class="bg-gray-100 min-h-screen">



<div class="container mx-auto p-6">

  <!-- ===== Search Form =====
  <form id="searchForm" class="mb-4 flex items-center gap-2">
    <input type="text" id="searchInput" placeholder="Search by product name" class="border border-gray-300 rounded px-2 py-1 flex-grow">
    <button type="submit" class="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700">Search</button>
  </form> -->

  <!-- ===== Add Product Button ===== -->
  <!-- <button id="addProductBtn" class="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 mb-4">
    Add Product
  </button> -->





 

















</div>










    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Check all functionality
        document.getElementById('checkAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('tbody input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    </script>





<!-- ================= Details Modal ================= -->
<div id="detailsModal" class="fixed inset-0 hidden z-50 flex items-center justify-center">
  <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>

  <div class="bg-white rounded-lg shadow-lg w-11/12 max-w-xl p-6 relative z-10 overflow-y-auto max-h-[90vh]">

    <!-- Description -->
    <p class="mb-4"><strong>Description:</strong> <span id="detailsDescription">-</span></p>

    <!-- Sizes & Stock -->
    <h3 class="font-semibold mb-2">Sizes & Stock:</h3>
    <div id="detailsVariants" class="mb-4">
      <!-- Filled dynamically via JS -->
    </div>

    <!-- Images -->
    <h3 class="font-semibold mb-2">Images:</h3>
    <div id="detailsImages" class="flex gap-2 flex-wrap mb-4">
      <!-- Filled dynamically via JS -->
    </div>

    <!-- Close Button -->
    <div class="flex justify-center">
      <button id="closeDetailsModal" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-semibold">
        Close
      </button>
    </div>
  </div>
</div>








<div class="bg-white rounded-lg shadow-md overflow-x-auto">
  <div class="card-body p-0 min-w-[1000px]">
    <table class="w-full border border-gray-300 min-w-[1000px]" id="productsTable">
      <thead class="bg-green-100">
        <tr>
          <th class="py-3 px-4 text-center">Name</th>
          <th class="py-3 px-4 text-center">Category</th>
          <th class="py-3 px-4 text-center">Image</th>
          <th class="py-3 px-4 text-center">Actions</th>
        </tr>
      </thead>

      <tbody>
        <% if(products.length > 0) { %>
          <% products.forEach(prod => { %>
            <tr class="border-t hover:bg-gray-50" style="height: 120px;">
              <td class="py-2 px-4 text-center align-middle"><%= prod.name %></td>
<td class="py-2 px-4 text-center align-middle">
  <% 
    let catName = "";
    // Try to find from categories array
    const cat = categories.find(c => c._id.toString() === prod.category?.toString());

    if (cat && cat.name) {
      catName = cat.name; // found in categories
    } else if (prod.categoryName) {
      catName = prod.categoryName; // backup name stored in product document
    } else if (prod.category && typeof prod.category === "object" && prod.category.name) {
      catName = prod.category.name; // if product.category is populated object
    } else {
      catName = "Category"; // still show something readable
    }
  %>
  <%= catName %>
</td>

              <td class="py-2 px-4 text-center align-middle">
                <% if (prod.productPic && prod.productPic.length > 0) { %>
                  <img src="<%= prod.productPic[0] %>" alt="<%= prod.name %>" class="h-20 w-20 object-cover rounded border mx-auto" />
                <% } else { %>
                  <div class="h-20 w-20 bg-gray-200 rounded flex items-center justify-center mx-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                  </div>
                <% } %>
              </td>
              <!-- <td class="py-2 px-4 flex gap-2 justify-center align-middle">
                <a href="javascript:void(0)" class="editBtn px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700" data-id="<%= prod._id %>">Edit</a>
               <% if (!prod.isDeleted) { %>
  <button 
    onclick="confirmToggle('<%= prod._id %>', 'unlist')" 
    class="px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700">
    Unlist
  </button>
<% } else { %>
  <button 
    onclick="confirmToggle('<%= prod._id %>', 'list')" 
    class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">
    List
  </button>
<% } %>

               
               
                <button 
                  class="px-3 py-1 bg-gray-600 text-white rounded text-xs hover:bg-gray-700" 
                  data-prod='<%= JSON.stringify(prod) %>' 
                  onclick="viewDetails(this)">
                  Details
                </button>
              </td> -->
           
           <td class="py-2 px-4 flex gap-2 justify-center align-middle">

  <!-- EDIT -->
  <button
    type="button"
    class="editBtn px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700"
    data-id="<%= prod._id %>">
    Edit
  </button>

  <% if (!prod.isDeleted) { %>
    <button 
      type="button"
      onclick="confirmToggle('<%= prod._id %>', 'unlist')" 
      class="px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700">
      Unlist
    </button>
  <% } else { %>
    <button 
      type="button"
      onclick="confirmToggle('<%= prod._id %>', 'list')" 
      class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">
      List
    </button>
  <% } %>

  <!-- DETAILS -->
  <button 
    type="button"
    class="px-3 py-1 bg-gray-600 text-white rounded text-xs hover:bg-gray-700"
    data-prod='<%= JSON.stringify(prod) %>' 
    onclick="viewDetails(this)">
    Details
  </button>

</td>

           
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="4" class="py-4 text-center text-gray-500">No products found</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>






				

<div
  class="border-t border-gray-300 flex flex-col md:flex-row justify-between items-center px-6 py-6 gap-3">
  <span>
    Showing <%= (currentPage - 1) * 7 + 1 %> 
    to <%= Math.min(currentPage * 7, totalProducts) %> 
    of <%= totalProducts %> entries
  </span>

  <nav class="flex items-center gap-x-1">
    <!-- Previous Button -->
    <button type="button"
      onclick="window.location.href='?page=<%= currentPage - 1 %>'"
      class="leading-none min-h-[36px] min-w-[36px] py-2 px-2.5 inline-flex justify-center items-center gap-x-1.5 rounded-md border bg-white border-gray-300 text-gray-800 hover:bg-gray-300 focus:outline-none focus:bg-gray-300 disabled:opacity-50 disabled:pointer-events-none"
      <%= currentPage === 1 ? 'disabled' : '' %>>
      Previous
    </button>

    <!-- Page Numbers -->
    <div class="flex items-center gap-x-1">
      <% for (let i = 1; i <= totalPages; i++) { %>
        <button type="button"
          onclick="window.location.href='?page=<%= i %>'"
          class="leading-none min-h-[36px] min-w-[36px] py-2 px-2.5 inline-flex justify-center items-center gap-x-1.5 rounded-md border <%= currentPage === i ? 'text-white bg-green-600 border-green-600 hover:bg-green-600' : 'bg-white border-gray-300 text-gray-800 hover:bg-gray-300' %> focus:outline-none">
          <%= i %>
        </button>
      <% } %>
    </div>

    <!-- Next Button -->
    <button type="button"
      onclick="window.location.href='?page=<%= currentPage + 1 %>'"
      class="leading-none min-h-[36px] min-w-[36px] py-2 px-2.5 inline-flex justify-center items-center gap-x-1.5 rounded-md border bg-white border-gray-300 text-gray-800 hover:bg-gray-300 focus:outline-none focus:bg-gray-300 disabled:opacity-50 disabled:pointer-events-none"
      <%= currentPage === totalPages ? 'disabled' : '' %>>
      Next
    </button>
  </nav>
</div>


</div>
				
			</main>
		</div>
	</div>

	
	<!-- Libs JS -->
<script src="../assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="../assets/libs/simplebar/dist/simplebar.min.js"></script>

<!-- Theme JS -->
<script>



document.getElementById("productForm").addEventListener("submit", function(e) {
  const category = document.getElementById("category").value.trim();
  const name = document.getElementById("productName").value.trim();
  const sizeRows = document.querySelectorAll(".size-row");
  let validSize = false;

  // Clear previous error
  const errorMsg = document.getElementById("errorMsg");
  errorMsg.classList.add("hidden");
  errorMsg.innerText = "";

  // Category check
  if (!category) {
    e.preventDefault();
    errorMsg.innerText = "Please select a category!";
    errorMsg.classList.remove("hidden");
    return;
  }

  // Product name check
  if (!name) {
    e.preventDefault();
    errorMsg.innerText = "Please enter product name!";
    errorMsg.classList.remove("hidden");
    return;
  }

  // Size validation
  sizeRows.forEach(row => {
    const checkbox = row.querySelector(".size-checkbox");
    const price = row.querySelector(".sizePrice").value.trim();
    const qty = row.querySelector(".sizeQty").value.trim();

    // Only validate if checkbox is checked
    if (checkbox.checked) {
      if (!price || isNaN(price) || Number(price) <= 0) {
        e.preventDefault();
        errorMsg.innerText = `Please enter a valid price for size ${checkbox.value}`;
        errorMsg.classList.remove("hidden");
        return;
      }
      if (!qty || isNaN(qty) || Number(qty) <= 0) {
        e.preventDefault();
        errorMsg.innerText = `Please enter a valid quantity for size ${checkbox.value}`;
        errorMsg.classList.remove("hidden");
        return;
      }
      validSize = true; // At least one valid size
    }
  });

  if (!validSize) {
    e.preventDefault();
    errorMsg.innerText = "Please select at least one size with valid price & quantity!";
    errorMsg.classList.remove("hidden");
    return;
  }

})








const searchInput = document.getElementById("searchInput");
  const clearBtn = document.getElementById("clearSearch");
  const searchForm = document.getElementById("productsSearchForm");
  const tableBody = document.querySelector("#productsTable tbody");

  //  Show/Hide cancel icon & trigger live search
let debounceTimer;

searchInput.addEventListener("input", () => {
  clearBtn.classList.toggle("hidden", searchInput.value.trim() === "");

  clearTimeout(debounceTimer);

  debounceTimer = setTimeout(() => {
    liveSearch();
  }, 1000); // 5 seconds delay
});


  //  Clear input and reload full product list
  clearBtn.addEventListener("click", () => {
    searchInput.value = "";
    clearBtn.classList.add("hidden");
    loadAllProducts();
  });

  //  Manual search button
  searchForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    liveSearch();
  });

  //  Live search
  async function liveSearch() {
    const query = searchInput.value.trim();
    if (query === "") {
      loadAllProducts();
      return;
    }

    try {
      const res = await fetch(`/admin/products/search?query=${encodeURIComponent(query)}`);
      const products = await res.json();

      tableBody.innerHTML = "";

      if (products.length === 0) {
        // Swal.fire({
        //   icon: "info",
        //   title: "No matching product found!",
        //   timer: 2000,
        //   showConfirmButton: false
        // });
        return;
      }

      products.forEach(prod => {
        const row = document.createElement("tr");
        row.className = "border-t hover:bg-gray-50";
        row.style.height = "120px";

        row.innerHTML = `
          <td class="py-2 px-4 text-center">${prod.name}</td>
          <td class="py-2 px-4 text-center">${prod.categoryName || "Category"}</td>
          <td class="py-2 px-4 text-center">
            ${prod.productPic && prod.productPic.length > 0
              ? `<img src="${prod.productPic[0]}" class="h-20 w-20 object-cover rounded border mx-auto"/>`
              : `<div class='h-20 w-20 bg-gray-200 rounded flex items-center justify-center mx-auto'>
                   <svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-gray-400' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
                     <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z'/>
                   </svg>
                 </div>`}
          </td>
          <td class="py-2 px-4 flex gap-2 justify-center">
            <a href="javascript:void(0)" class="editBtn px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700" data-id="${prod._id}">Edit</a>
            <button onclick="confirmDelete('${prod._id}')" class="px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700">Delete</button>
            <button class="px-3 py-1 bg-gray-600 text-white rounded text-xs hover:bg-gray-700"
              data-prod='${JSON.stringify(prod)}' onclick="viewDetails(this)">Details</button>
          </td>
        `;

        tableBody.appendChild(row);
      });
    } catch (error) {
      console.error("Search Error:", error);
      Swal.fire({
        icon: "error",
        title: "Server Error!",
        text: "Something went wrong. Try again later.",
      });
    }
  }

  // üîπ Reload all products
  async function loadAllProducts() {
    const res = await fetch("/admin/products");
    const html = await res.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");
    const newRows = doc.querySelector("#productsTable tbody").innerHTML;
    tableBody.innerHTML = newRows;
  }






document.querySelectorAll(".size-checkbox").forEach(chk => {
  chk.addEventListener("change", function() {
    const parent = this.parentElement;
    const priceInput = parent.querySelector(".price-input");
    const qtyInput = parent.querySelector(".qty-input");

    if(this.checked){
      priceInput.classList.remove("hidden");
      qtyInput.classList.remove("hidden");
    } else {
      priceInput.classList.add("hidden");
      qtyInput.classList.add("hidden");
      priceInput.value = "";
      qtyInput.value = "";
    }
  });
});



// ================= Prefill Edit Modal =================
function openEditModal(product, categoriesList) {
  const modal = document.getElementById('editProductModal');
  modal.classList.remove('hidden');

  // Fill id and category
  document.getElementById('editProductId').value = product._id || '';
  const categorySelect = document.getElementById('editCategory');
  categorySelect.innerHTML = '';
  categoriesList.forEach(cat => {
    const opt = document.createElement('option');
    opt.value = cat._id;
    opt.textContent = cat.name;
    if (product.category && product.category.toString() === cat._id.toString()) opt.selected = true;
    categorySelect.appendChild(opt);
  });

  // Fill other fields
  document.getElementById('editName').value = product.name || '';
  document.getElementById('editDescription').value = product.description || '';

  // Fill sizes (S, M, L)
  const sizes = ["S", "M", "L"];
  const container = document.getElementById('editSizeContainer');
  container.innerHTML = '';

  sizes.forEach((size, idx) => {
    const price = product.prices?.[idx] || 0;
    const qty = product.quantities?.[idx] || 0;

    const div = document.createElement('div');
    div.className = 'flex items-center gap-2';

    div.innerHTML = `
      <input type="checkbox" class="edit-size-checkbox" id="editSize${size}" data-index="${idx}">
      <label for="editSize${size}">${size}</label>
      <input type="number" class="edit-price-input border p-1 w-20 hidden" placeholder="Price" value="${price}">
      <input type="number" class="edit-qty-input border p-1 w-20 hidden" placeholder="Qty" value="${qty}">
    `;

    container.appendChild(div);

    const checkbox = div.querySelector('.edit-size-checkbox');
    const priceInput = div.querySelector('.edit-price-input');
    const qtyInput = div.querySelector('.edit-qty-input');

    // Show price/qty if > 0
    if (price > 0 || qty > 0) checkbox.checked = true;
    if (checkbox.checked) {
      priceInput.classList.remove('hidden');
      qtyInput.classList.remove('hidden');
    }

    checkbox.addEventListener('change', () => {
      if (checkbox.checked) {
        priceInput.classList.remove('hidden');
        qtyInput.classList.remove('hidden');
      } else {
        priceInput.classList.add('hidden');
        qtyInput.classList.add('hidden');
        priceInput.value = 0;
        qtyInput.value = 0;
      }
    });
  });
}

// ================= Close Edit Modal =================
document.getElementById('closeEditModal')?.addEventListener('click', () => {
  document.getElementById('editProductModal').classList.add('hidden');
});



// ================= View Details Modal =================
function getSelectedSizes() {
  const sizesData = Array.from(document.querySelectorAll(".sizeCheckbox")).map(cb => {
    const parent = cb.closest("label");
    if(cb.checked){
      return {
        size: cb.value,
        price: Number(parent.querySelector(".sizePrice").value || 0),
        quantity: Number(parent.querySelector(".sizeQty").value || 0)
      };
    }
  }).filter(v => v); // remove unchecked
  return sizesData;
}

// ================= View Details Modal =================
function viewDetails(button) {
  const prod = JSON.parse(button.dataset.prod);

  // Description
  document.getElementById("detailsDescription").textContent = prod.description || "-";

  // Sizes & Stock
  const variantsContainer = document.getElementById("detailsVariants");
  variantsContainer.innerHTML = "";

  const sizes = Array.isArray(prod.sizes) ? prod.sizes : [];
  const prices = Array.isArray(prod.prices) ? prod.prices : [];
  const quantities = Array.isArray(prod.quantities) ? prod.quantities : [];

  if (sizes.length > 0) {
    sizes.forEach((size, idx) => {
      const price = prices[idx] ?? 0;
      const qty = quantities[idx] ?? 0;

      const div = document.createElement("div");
      div.textContent = `Size: ${size}, Price: ‚Çπ${price}, Qty: ${qty}`;
      variantsContainer.appendChild(div);
    });
  } else {
    variantsContainer.textContent = "No sizes available";
  }

  // Images
  const imagesContainer = document.getElementById("detailsImages");
  imagesContainer.innerHTML = "";
  if (prod.productPic && prod.productPic.length > 0) {
    prod.productPic.forEach(src => {
      const img = document.createElement("img");
      img.src = src;
      img.className = "w-24 h-24 object-cover border rounded";
      imagesContainer.appendChild(img);
    });
  } else {
    imagesContainer.textContent = "No images available";
  }

  // Show modal
  const modal = document.getElementById("detailsModal");
  modal.classList.remove("hidden");
  document.body.style.overflow = "hidden";
}

// Close Details Modal
function closeDetailsModal() {
  const modal = document.getElementById("detailsModal");
  modal.classList.add("hidden");
  document.body.style.overflow = "auto";
}
document.getElementById("closeDetailsModal")?.addEventListener("click", closeDetailsModal);
document.getElementById("detailsModal")?.addEventListener("click", e => {
  if(e.target.id === "detailsModal") closeDetailsModal();
});



// ================= Add/Edit Product Modal =================
document.addEventListener("DOMContentLoaded", () => {
  let cropper, currentPreview;
  let isEditMode = false;
  let existingImagesCount = 0;
  let variantCount = 0;

  const addProductModal = document.getElementById('addProductModal');
  const closeModalBtn = document.getElementById('closeModal');
  const addProductBtn = document.getElementById('addProductBtn');
  const cropModal = document.getElementById('cropModal');
  const productForm = document.getElementById('productForm');
  const modalTitle = document.getElementById('modalTitle');
  const errorMsg = document.getElementById('errorMsg');
  const addVariantBtn = document.getElementById('addVariantBtn');
  const imageInputs = document.querySelectorAll(".imageInput");
  const removeXBtns = document.querySelectorAll(".removeX");
  const category = document.getElementById("category");
  const productName = document.getElementById("productName");
  const description = document.getElementById("description");
  const sizeRows = document.querySelectorAll(".size-row");
  const variantsInput = document.getElementById("variantsInput");

  // ================= REMOVE ERROR ON INPUT =================
  [category, productName, description, ...imageInputs].forEach(input => {
    input.addEventListener("input", () => {
      errorMsg.classList.add("hidden");
      errorMsg.textContent = "";
    });
  });

  // ================= OPEN ADD MODAL =================
  addProductBtn?.addEventListener('click', () => {
    isEditMode = false;
    existingImagesCount = 0;
    variantCount = 0;
    modalTitle.textContent = "Add Product";
    productForm.action = "/admin/products/add";
    productForm.reset();
    removeXBtns.forEach(x => x.classList.add("hidden"));
    document.querySelectorAll("img[id^='preview']").forEach(img => img.classList.add("hidden"));
    document.querySelectorAll("span[id^='plus']").forEach(span => span.classList.remove("hidden"));
    errorMsg.classList.add("hidden");

    // Reset size checkboxes
    document.querySelectorAll(".size-checkbox").forEach(cb => {
      cb.checked = false;
      const priceInput = cb.nextElementSibling.nextElementSibling;
      const qtyInput = priceInput.nextElementSibling;
      priceInput.value = '';
      qtyInput.value = '';
      priceInput.classList.add('hidden');
      qtyInput.classList.add('hidden');
    });

    addProductModal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  });

  // ================= CLOSE MODAL =================
  function closeModalFunc() {
    addProductModal.classList.add('hidden');
    document.body.style.overflow = 'auto';
    productForm.reset();
    errorMsg.classList.add("hidden");
  }
  closeModalBtn?.addEventListener('click', closeModalFunc);
  addProductModal?.addEventListener('click', e => {
    if (e.target === addProductModal) closeModalFunc();
  });

  // ================= IMAGE INPUT & CROPPER =================
  imageInputs.forEach(input => {
    input.addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = event => {
        currentPreview = document.getElementById(input.dataset.preview);
        const cropImageEl = document.getElementById("cropImage");
        cropImageEl.src = event.target.result;
        cropImageEl.style.maxWidth = "400px";
        cropImageEl.style.maxHeight = "300px";
        cropModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        if (cropper) cropper.destroy();
        cropper = new Cropper(cropImageEl, { aspectRatio: 16/9, viewMode: 1 });
      };
      reader.readAsDataURL(file);
    });
  });

  document.getElementById("cancelCrop")?.addEventListener("click", () => {
    cropModal.classList.add("hidden");
    document.body.style.overflow = 'auto';
    if (cropper) cropper.destroy();
  });

  document.getElementById("applyCrop")?.addEventListener("click", () => {
    if (!cropper) return;
    const canvas = cropper.getCroppedCanvas({ width: 160, height: 100 });
    currentPreview.src = canvas.toDataURL();
    currentPreview.classList.remove("hidden");
    cropModal.classList.add("hidden");
    document.body.style.overflow = 'auto';
    cropper.destroy();
    currentPreview.parentElement.querySelector(".removeX").classList.remove("hidden");
    currentPreview.parentElement.querySelector(`#plus${currentPreview.id.slice(-1)}`).classList.add("hidden");
  });

  removeXBtns.forEach(xBtn => {
    xBtn.addEventListener("click", function(e) {
      e.stopPropagation();
      const previewId = this.dataset.preview;
      const img = document.getElementById(previewId);
      img.src = "";
      img.classList.add("hidden");
      this.classList.add("hidden");
      img.parentElement.querySelector(`#plus${previewId.slice(-1)}`).classList.remove("hidden");
      img.parentElement.querySelector(".imageInput").value = "";
    });
  });

  // ================= SIZE CHECKBOX TOGGLE =================
  document.querySelectorAll('.size-checkbox').forEach(cb => {
    cb.addEventListener('change', function(){
      const priceInput = this.nextElementSibling.nextElementSibling;
      const qtyInput = priceInput.nextElementSibling;
      if(this.checked){
        priceInput.classList.remove('hidden');
        qtyInput.classList.remove('hidden');
      } else {
        priceInput.classList.add('hidden');
        qtyInput.classList.add('hidden');
        priceInput.value = '';
        qtyInput.value = '';
      }
    });
  });

const menuBtn = document.getElementById("menuBtn");
const sidebar = document.querySelector("aside");

menuBtn.onclick = () => {
  sidebar.classList.toggle("open");
}

  productForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  errorMsg.classList.add("hidden");
  let errors = [];

  // Category validation
  if (!category.value) errors.push("Please select a category.");



const nameValue = productName.value.trim();

if (!nameValue) {
  errors.push("Please enter product name.");
} else {

  // MIN 7 characters
  if (nameValue.length < 7) {
    errors.push("Product name must be at least 7 characters.");
  }

  // MAX 25 characters
  if (nameValue.length > 30) {
    errors.push("Product name cannot exceed 30 characters.");
  }
}


  // ==========================
  // DESCRIPTION VALIDATION
  // ==========================
  if (!description.value.trim()) {
    errors.push("Please enter product description.");
  } else {
    const descText = description.value.trim();

    const wordCount = descText.split(/\s+/).filter(w => w.length > 0).length;
    if (wordCount > 50) {
      errors.push("Description cannot exceed 50 words.");
    }
  if (descText.length < 40) {
    errors.push("Description must be at least 40 characters.");
  }
   else if (descText.length > 250) {
      errors.push("Description cannot exceed 250 characters.");
    }
  }
//// image valitaion 

let newImagesCount = Array.from(imageInputs).filter(
  inp => inp.files && inp.files.length > 0
).length;

let existingImages = Array.from(
  document.querySelectorAll("img[id^='preview']")
).filter(img => img.src && !img.classList.contains("hidden")).length;

if (!isEditMode) {
  if (newImagesCount !== 3) {
    errors.push("Please select all 3 images.");
  }
} else {
  if (existingImages + newImagesCount < 3) {
    errors.push("Product must have at least 3 images.");
  }
}



  // ==========================
  // SIZE + PRICE + QTY VALIDATION
  // ==========================
  let variants = [];

  sizeRows.forEach((row) => {
    const checkbox = row.querySelector(".size-checkbox");
    const price = row.querySelector(".sizePrice");
    const qty = row.querySelector(".sizeQty");

    if (checkbox.checked) {

      // PRICE VALIDATION
      if (!price.value || price.value <= 0) {
        errors.push(`Enter valid price for size ${checkbox.value}`);
      } else if (price.value.length > 7) {
        errors.push(`Price for size ${checkbox.value} cannot exceed 7 digits.`);
      }

      // QTY VALIDATION
      if (!qty.value || qty.value <= 0) {
        errors.push(`Enter valid quantity for size ${checkbox.value}`);
      } else if (qty.value.length > 7) {
        errors.push(`Quantity for size ${checkbox.value} cannot exceed 7 digits.`);
      }

      variants.push({
        size: checkbox.value,
        price: Number(price.value),
        qty: Number(qty.value),
      });
    }
  });

  if (variants.length === 0) {
    errors.push("Please select at least one size with price and quantity.");
  }

  // ==========================
  // ERROR DISPLAY
  // ==========================
  if (errors.length > 0) {
    errorMsg.innerHTML = errors.join("<br>");
    errorMsg.classList.remove("hidden");
    return;
  }

  // Fill hidden input
  variantsInput.value = JSON.stringify(variants);

  // Prepare formData
  const formData = new FormData(productForm);
  variants.forEach((v) => {
    formData.append("sizes[]", v.size);
    formData.append("prices[]", v.price);
    formData.append("quantities[]", v.qty);
  });

  try {
    const res = await fetch(productForm.action, {
      method: "POST",
      body: formData,
    });

    const data = await res.json();

    if (data.success) {
      Swal.fire("Success", data.message, "success").then(() =>
        window.location.reload()
      );
    } else {
      Swal.fire("Error", data.message, "error");
    }
  } catch (err) {
    Swal.fire("Error", "Server Error", "error");
    console.error(err);
  }
});



  // Optional: Remove size row
  document.querySelectorAll(".removeSizeBtn").forEach(btn => {
    btn.addEventListener("click", () => {
      btn.closest(".size-row").remove();
    });
  });

  // ================= EDIT PRODUCT =================
  document.querySelectorAll(".editBtn").forEach(btn => {
    btn.addEventListener("click", async () => {
      isEditMode = true;
      const prodId = btn.dataset.id;
      const res = await fetch(`/admin/products/${prodId}`);
      const data = await res.json();

      modalTitle.textContent = "Edit Product";
      productForm.action = `/admin/products/edit/${prodId}`;
      productForm.reset();
      variantCount = 0;

      productName.value = data.product.name || "";
      description.value = data.product.description || "";
      category.value = data.product.category || "";

      // Prefill size checkboxes with old price & qty
      prefillSizes(data.product);

      // Prefill images
      ["preview0","preview1","preview2"].forEach((id,i)=>{
        const imgEl = document.getElementById(id);
        if(data.product.productPic && data.product.productPic[i]){
          imgEl.src = data.product.productPic[i];
          imgEl.classList.remove("hidden");
          imgEl.parentElement.querySelector(".removeX").classList.remove("hidden");
          imgEl.parentElement.querySelector(`#plus${i}`).classList.add("hidden");
        } else {
          imgEl.src = "";
          imgEl.classList.add("hidden");
          imgEl.parentElement.querySelector(".removeX").classList.add("hidden");
          imgEl.parentElement.querySelector(`#plus${i}`).classList.remove("hidden");
        }
      });

      existingImagesCount = data.product.productPic?.length || 0;
      addProductModal.classList.remove("hidden");
      document.body.style.overflow = 'hidden';
    });
  });

  // ================= PREFILL SIZES FUNCTION =================
  // function prefillSizes(product){
  //   const sizeCheckboxes = document.querySelectorAll('.size-checkbox');
  //   sizeCheckboxes.forEach(cb => {
  //     const size = cb.value;
  //     const idx = product.sizes?.indexOf(size) ?? -1;
  //     const priceInput = cb.nextElementSibling.nextElementSibling;
  //     const qtyInput = priceInput.nextElementSibling;

  //     if(idx > -1){
  //       cb.checked = true;
  //       priceInput.value = product.prices[idx];
  //       qtyInput.value = product.quantities[idx];
  //       priceInput.classList.remove('hidden');
  //       qtyInput.classList.remove('hidden');
  //     } else {
  //       cb.checked = false;
  //       priceInput.value = '';
  //       qtyInput.value = '';
  //       priceInput.classList.add('hidden');
  //       qtyInput.classList.add('hidden');
  //     }
  //   });
  // }


  function prefillSizes(product) {
  const sizeCheckboxes = document.querySelectorAll('.size-checkbox');

  sizeCheckboxes.forEach(cb => {
    const size = cb.value;
    const idx = product.sizes?.indexOf(size);

    const priceInput = cb.nextElementSibling.nextElementSibling;
    const qtyInput = priceInput.nextElementSibling;

    const price = idx > -1 ? Number(product.prices[idx]) : 0;
    const qty = idx > -1 ? Number(product.quantities[idx]) : 0;

    if (price > 0 && qty > 0) {
      cb.checked = true;
      priceInput.value = price;
      qtyInput.value = qty;
      priceInput.classList.remove('hidden');
      qtyInput.classList.remove('hidden');
    } else {
      cb.checked = false;
      priceInput.value = '';
      qtyInput.value = '';
      priceInput.classList.add('hidden');
      qtyInput.classList.add('hidden');
    }
  });
}


window.confirmToggle = function (id, action) {
  const isUnlist = action === "unlist";

  Swal.fire({
    title: isUnlist ? "Unlist this product?" : "List this product?",
    text: isUnlist
      ? "Product will be hidden from users."
      : "Product will be visible to users.",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: isUnlist ? "#d33" : "#16a34a",
    cancelButtonColor: "#6b7280",
    confirmButtonText: isUnlist ? "Yes, Unlist" : "Yes, List",
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = `/admin/products/toggle/${id}`;
    }
  });
};






});

</script>


<script src="../assets/js/theme.min.js"></script>

</body>


<!-- Mirrored from freshcart-tailwind.codescandy.com/dashboard/products.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Dec 2024 13:19:37 GMT -->
</html>


