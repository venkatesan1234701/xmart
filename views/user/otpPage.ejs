<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon/favicon.ico" />

  <!-- Libs CSS -->
  <link rel="preconnect" href="https://fonts.googleapis.com/" />
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" />
  <link rel="stylesheet" href="../cdn.jsdelivr.net/npm/%40tabler/icons-webfont%402.46.0/tabler-icons.min.css" />
  <link rel="stylesheet" href="../assets/css/theme.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <title>OTP Verification - Bro Basket</title>
  <style>
  body {
    font-family: 'Inter', sans-serif;
    background: #f8fafc;
    margin: 0;
    padding: 0;
  }

  /* Navbar */
  nav {
    background: #ffffff;
    border-bottom: 1px solid #e5e7eb;
  }

  nav img {
    width: 150px;
  }

  /* Page Layout */
  section {
    animation: fadeIn 0.5s ease-out;
  }

  /* OTP Card */
  .otp-card {
    background: white;
    border-radius: 18px;
    padding: 40px;
    max-width: 420px;
    width: 100%;
    margin: auto;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.07);
  }

  /* OTP Inputs */
  .otp-input {
    width: 48px;
    height: 56px;
    font-size: 22px;
    border-radius: 10px;
    border: 1px solid #cbd5e1;
    text-align: center;
    transition: all 0.2s ease;
  }

  .otp-input:focus {
    border-color: #16a34a;
    box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.25);
    outline: none;
  }

  /* Verify Button */
  .verify-btn {
    width: 100%;
    padding: 12px;
    font-weight: 600;
    background: #16a34a;
    color: white;
    border-radius: 10px;
    transition: 0.2s ease;
    box-shadow: 0 4px 15px rgba(22, 163, 74, 0.35);
  }

  .verify-btn:hover {
    background: #15803d;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(22, 163, 74, 0.45);
  }

  /* Resend OTP Button */
  #resendBtn {
    background: transparent;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s ease;
  }

  #resendBtn:not(:disabled):hover {
    color: #0f9d58;
    transform: scale(1.05);
  }

  #resendBtn:disabled {
    color: #9ca3af;
    cursor: not-allowed;
  }

  /* Footer Styles */
  footer {
    background: #f1f5f9;
    border-top: 1px solid #e2e8f0;
  }

  /* Fade Animation */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to   { opacity: 1; transform: translateY(0); }
  }
</style>

</head>

<body>
  <main>
    <!-- navigation -->
    <div class="border-b shadow-sm">
      <nav class="relative md:flex flex-wrap w-full items-center py-3 text-center">
        <div class="container sm:flex justify-between items-center">
          <a class="inline-block mr-4 text-lg whitespace-no-wrap" href="index.html">
            <img src="../assets/images/logo/Xe mart.png" alt="" class="inline-block align-text-top" />
          </a>
          <span class="inline-block">
            Already have an account?
            <a href="/signin" class="text-green-600">Sign in</a>
          </span>
        </div>
      </nav>
    </div>

    <!-- section -->
    <section class="my-10">
      <div class="container">
        <div class="flex flex-wrap justify-center items-center gap-8 lg:gap-16">
          <!-- Image -->
          <div class="w-full md:w-1/3 xl:w-1/3 lg:order-1 order-2">
            <img src="../assets/images/svg-graphics/fp-g.svg" alt="" class="max-w-full h-auto" />
          </div>

          <!-- OTP Form -->
          <div class="w-full md:w-1/2 xl:w-1/3 lg:order-2 order-1 flex flex-col gap-6">
            <div class="flex flex-col gap-1">
              <h1 class="text-xl font-semibold">OTP Verification</h1>
              <p>Please enter the 6-digit OTP sent to your email.</p>
            </div>
<div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-md">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Enter OTP</h2>

    <!-- OTP Form -->
    <form action="/verify-otp" method="post" class="needs-validation space-y-6">
      <div class="flex justify-center gap-2">
        <% for (let i = 1; i <= 6; i++) { %>
          <input type="text" name="otp<%= i %>" maxlength="1"
            class="w-12 h-12 text-center border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:outline-none" autocomplete="off"/>
        <% } %>
      </div>

      <!-- Submit Button -->
      <div class="w-full grid mt-6">
        <button type="submit"
          class="btn inline-flex items-center justify-center gap-x-2 bg-green-600 text-white px-4 py-2 rounded-lg border-green-600 hover:bg-green-700 focus:ring-4 focus:ring-green-300">
          Verify OTP
        </button>
      </div>
    </form>
  </div>

			

            <!-- Resend OTP -->
<div class="mt-4 text-sm text-gray-600 text-center">
  Didn’t receive OTP?
<form id="resendOtpForm" action="/resend-otp" method="POST">
  <input type="hidden" name="email" value="<%= email %>">
  <button id="resendBtn" type="submit" class="text-green-600 font-medium">
    Resend OTP in <span id="timer">30</span>s
  </button>
</form>
</div>
</form>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>



 <% if (typeof error !== "undefined") { %>
    <script>
      Swal.fire({
        icon: "error",
        title: "Oops!",
        text: "<%= error %>",
      });
    </script>
  <% } %>

<% if (typeof success !== "undefined" && success) { %>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    // default redirect '/' if redirectUrl undefined
    const redirectUrl = "<%= typeof redirectUrl !== 'undefined' && redirectUrl ? redirectUrl : '/signin' %>";

    Swal.fire({
      icon: "success",
      title: "Success!",
      text: "<%= success %>",
      timer: 2000,
      showConfirmButton: false
    }).then(() => {
      window.location.href = redirectUrl;
    });
  </script>
<% } %>




  <!-- footer (same as your code) -->
  <!-- footer -->
<footer class="bg-gray-200 py-8">
	<div class="container">
		<div class="flex flex-wrap md:gap-4 lg:gap-0 py-4 mb-6">
			<div class="w-full md:w-full lg:w-1/3 flex flex-col gap-4 mb-6">
				<h6>Categories</h6>
				<div class="flex flex-wrap">
					<div class="w-1/2">
						<!-- list -->
						<ul class="flex flex-col gap-2">
							<li><a href="#!" class="inline-block hover:text-green-600">Vegetables & Fruits</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Breakfast & instant food</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Bakery & Biscuits</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Atta, rice & dal</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Sauces & spreads</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Organic & gourmet</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Baby care</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Cleaning essentials</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Personal care</a></li>
						</ul>
					</div>
					<div class="w-1/2">
						<!-- list -->
						<ul class="flex flex-col gap-2">
							<li><a href="#!" class="inline-block hover:text-green-600">Dairy, bread & eggs</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Cold drinks & juices</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Tea, coffee & drinks</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Masala, oil & more</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Chicken, meat & fish</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Paan corner</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Pharma & wellness</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Home & office</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Pet care</a></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="w-full md:w-full lg:w-2/3">
				<div class="flex flex-wrap">
					<div class="w-1/2 sm:w-1/2 md:w-1/4 flex flex-col gap-4 mb-6">
						<h6>Get to know us</h6>
						<!-- list -->
						<ul class="flex flex-col gap-2">
							<li><a href="#!" class="inline-block hover:text-green-600">Company</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">About</a></li>
							<li><a href="#!" class="inline-block">Blog</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Help Center</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Our Value</a></li>
						</ul>
					</div>
					<div class="w-1/2 sm:w-1/2 md:w-1/4 flex flex-col gap-4 mb-6">
						<h6>For Consumers</h6>
						<ul class="flex flex-col gap-2">
							<!-- list -->
							<li><a href="#!" class="inline-block hover:text-green-600">Payments</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Shipping</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Product Returns</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">FAQ</a></li>
							<li><a href="shop-checkout.html" class="inline-block">Shop Checkout</a></li>
						</ul>
					</div>
					<div class="w-1/2 sm:w-1/2 md:w-1/4 flex flex-col gap-4">
						<h6>Become a Shopper</h6>
						<ul class="flex flex-col gap-2">
							<!-- list -->
							<li><a href="#!" class="inline-block hover:text-green-600">Shopper Opportunities</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Become a Shopper</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Earnings</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Ideas & Guides</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">New Retailers</a></li>
						</ul>
					</div>
					<div class="w-1/2 sm:w-1/2 md:w-1/4 flex flex-col gap-4">
						<h6>Freshcart programs</h6>
						<ul class="flex flex-col gap-2">
							<!-- list -->
							<li><a href="#!" class="inline-block hover:text-green-600">Freshcart programs</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Gift Cards</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Promos & Coupons</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Freshcart Ads</a></li>
							<li><a href="#!" class="inline-block hover:text-green-600">Careers</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="border-t py-4 border-gray-300">
			<div class="gap-y-4 flex flex-wrap items-center justify-center lg:justify-start">
				<div class="lg:w-2/5 lg:text-left text-center">
					<div class="flex md:flex-row flex-col gap-3 md:gap-6 items-center">
						<div class="text-gray-900">Payment Partners</div>
						<ul class="flex items-center flex-row gap-4">
							<li>
								<a href="#!"><img src="../assets/images/payment/amazonpay.svg" alt="amazon pay" /></a>
							</li>
							<li>
								<a href="#!"><img src="../assets/images/payment/american-express.svg" alt="american express" /></a>
							</li>
							<li>
								<a href="#!"><img src="../assets/images/payment/mastercard.svg" alt="mastercard" /></a>
							</li>
							<li>
								<a href="#!"><img src="../assets/images/payment/paypal.svg" alt="paypal" /></a>
							</li>
							<li>
								<a href="#!"><img src="../assets/images/payment/visa.svg" alt="visa" /></a>
							</li>
						</ul>
					</div>
				</div>
				<div class="lg:w-3/5 flex justify-end">
					<div class="flex flex-col md:flex-row items-center gap-3 md:gap-6">
						<div class="text-gray-900">Get deliveries with FreshCart</div>
						<ul class="flex flex-row gap-2">
							<li>
								<a href="#!"><img src="../assets/images/appbutton/appstore-btn.svg" alt="" style="width: 140px" /></a>
							</li>
							<li>
								<a href="#!"><img src="../assets/images/appbutton/googleplay-btn.svg" alt="" style="width: 140px" /></a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="border-t py-4 border-gray-300">
			<div class="flex flex-col md:flex-row items-center gap-3">
				<div class="md:w-1/2">
					<span class="text-sm text-gray-500">
						©
						<span id="copyright">
							<script>
								document.getElementById('copyright').appendChild(document.createTextNode(new Date().getFullYear()));
							</script>
						</span>
						FreshCart TailwindCSS eCommerce HTML Template. Powered by
						<a href="https://codescandy.com/" target="_blank" class="text-green-600">Codescandy</a>
						.
					</span>
				</div>
				<div class="md:w-1/2 flex md:justify-end items-center">
					<div class="flex flex-row gap-5 items-center">
						<div class="text-gray-500">Follow us on</div>
						<ul class="flex items-center justify-end text-sm gap-1">
							<li>
								<a
									href="#!"
									class="inline-flex justify-center items-center align-middle text-center select-none border font-normal whitespace-no-wrap rounded leading-normal no-underline h-8 w-8 border-gray-300 hover:border-green-600 hover:text-green-600 transition ease-in-out"
								>
									<svg
										xmlns="http://www.w3.org/2000/svg"
										class="icon icon-tabler icon-tabler-brand-facebook"
										width="16"
										height="16"
										viewBox="0 0 24 24"
										stroke-width="1.5"
										stroke="currentColor"
										fill="none"
										stroke-linecap="round"
										stroke-linejoin="round"
									>
										<path stroke="none" d="M0 0h24v24H0z" fill="none" />
										<path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3" />
									</svg>
								</a>
							</li>
							<li>
								<a
									href="#!"
									class="inline-flex justify-center items-center align-middle text-center select-none border font-normal whitespace-no-wrap rounded leading-normal no-underline h-8 w-8 border-gray-300 hover:border-green-600 hover:text-green-600 transition ease-in-out"
								>
									<svg
										xmlns="http://www.w3.org/2000/svg"
										class="icon icon-tabler icon-tabler-brand-x"
										width="16"
										height="16"
										viewBox="0 0 24 24"
										stroke-width="1.5"
										stroke="currentColor"
										fill="none"
										stroke-linecap="round"
										stroke-linejoin="round"
									>
										<path stroke="none" d="M0 0h24v24H0z" fill="none" />
										<path d="M4 4l11.733 16h4.267l-11.733 -16z" />
										<path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772" />
									</svg>
								</a>
							</li>
							<li>
								<a
									href="#!"
									class="inline-flex justify-center items-center align-middle text-center select-none border font-normal whitespace-no-wrap rounded leading-normal no-underline h-8 w-8 border-gray-300 hover:border-green-600 hover:text-green-600 transition ease-in-out"
								>
									<svg
										xmlns="http://www.w3.org/2000/svg"
										class="icon icon-tabler icon-tabler-brand-instagram"
										width="16"
										height="16"
										viewBox="0 0 24 24"
										stroke-width="1.5"
										stroke="currentColor"
										fill="none"
										stroke-linecap="round"
										stroke-linejoin="round"
									>
										<path stroke="none" d="M0 0h24v24H0z" fill="none" />
										<path d="M4 4m0 4a4 4 0 0 1 4 -4h8a4 4 0 0 1 4 4v8a4 4 0 0 1 -4 4h-8a4 4 0 0 1 -4 -4z" />
										<path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
										<path d="M16.5 7.5l0 .01" />
									</svg>
								</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>

  <!-- Scripts -->



<script>

  // =========================
  // OTP INPUT HANDLING
  // =========================
  const otpInputs = document.querySelectorAll('input[name^="otp"]');
  otpInputs.forEach((input, index) => {
    input.addEventListener("input", (e) => {
      if (!/^\d$/.test(e.target.value)) {
        e.target.value = "";
        return;
      }
      if (index < otpInputs.length - 1) otpInputs[index + 1].focus();
    });

    input.addEventListener("keydown", (e) => {
      if (e.key === "Backspace" && !input.value && index > 0) {
        otpInputs[index - 1].focus();
      }
    });
  });



  // =========================
  // RESEND OTP TIMER
  // =========================

  const resendBtn = document.getElementById("resendBtn");
  let timerSpan = document.getElementById("timer");

// Check if page is opened for the first time
const firstLoad = sessionStorage.getItem("otpPageLoaded") === null;

if (firstLoad) {
  timer = 90;  // Always start from 90 on first entry
  sessionStorage.setItem("otpTimer", 90);
  sessionStorage.setItem("otpPageLoaded", "true");
} else {
  timer = parseInt(sessionStorage.getItem("otpTimer")) || 90;

  if (timer <= 0 || isNaN(timer)) {
    timer = 90;
    sessionStorage.setItem("otpTimer", 90);
  }
}


  let countdown;

  function renderButton() {
    resendBtn.innerHTML = `Resend OTP in <span id="timer">${timer}</span>s`;
    timerSpan = document.getElementById("timer");
  }

  function startCountdown() {
    if (countdown) clearInterval(countdown);

    resendBtn.disabled = true;
    renderButton();

    countdown = setInterval(() => {
      timer--;
      sessionStorage.setItem("otpTimer", timer);

      if (timerSpan) {
        timerSpan.textContent = timer;
      }

      if (timer <= 0) {
        clearInterval(countdown);
        resendBtn.disabled = false;
        resendBtn.textContent = "Resend OTP";
        sessionStorage.removeItem("otpTimer");
      }
    }, 1000);
  }

  renderButton();
  startCountdown();



  // =========================
  // RESEND OTP BUTTON CLICK
  // =========================
  resendBtn.addEventListener("click", async (e) => {
    e.preventDefault();

    // Reset to 90 seconds always
    timer = 90;
    sessionStorage.setItem("otpTimer", 90);

    // Restart countdown
    startCountdown();

    try {
      const email = "<%= email %>";

      await fetch("/resend-otp", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      });

      Swal.fire({
        icon: "success",
        title: "OTP Sent",
        text: "A new OTP has been sent!"
      });

    } catch (err) {
      console.error(err);

      Swal.fire({
        icon: "error",
        title: "Error",
        text: "Failed to resend OTP"
      });

      clearInterval(countdown);
      resendBtn.disabled = false;
      renderButton();
      sessionStorage.removeItem("otpTimer");
    }
  });

</script>







</body>
</html>