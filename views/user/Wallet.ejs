<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title> Wallet</title>

	<!-- Bootstrap 5 -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

	<style>
     body {
      background-color: #f8fafc;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
    }
    .navbar-nav {
      display: flex !important;
      gap: 1rem !important;
    }
    .navbar-nav .nav-link {
      font-weight: 500;
      color: #333 !important;
    }
    .navbar-nav .nav-link:hover {
      color: #0d6efd !important;
    }
    .table th, .table td {
      vertical-align: middle;
    }
		body {
			font-family: "Inter", sans-serif;
			background-color: #f8f9fa;
		}

		.wallet-container {
			background: white;
			border-radius: 10px;
			padding: 25px;
			margin-top: 50px;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
		}

		.wallet-balance {
			font-size: 24px;
			font-weight: bold;
			color: #198754;
			margin-bottom: 20px;
		}

		.transaction-table th {
			background-color: #198754;
			color: white;
		}

		.footer {
			background-color: #198754;
			color: white;
			text-align: center;
			padding: 15px 0;
			margin-top: 40px;
		}

		.btn-success {
			background-color: #198754;
			border: none;
		}

		.btn-success:hover {
			background-color: #157347;
		}
	</style>
</head>

<body>

	<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
  <div class="container d-flex justify-content-between align-items-center">
    <a class="navbar-brand text-primary fw-bold" href="/user/profile">Profile</a>
    <ul class="navbar-nav flex-row gap-4 mb-0">
      <li class="nav-item"><a class="nav-link" href="/user/orders">Order History</a></li>
      <li class="nav-item"><a class="nav-link" href="/user/wallet">Wallet</a></li>
      <li class="nav-item"><a class="nav-link" href="/user/add-address">Add Address</a></li>
    </ul>
    <div class="d-flex align-items-center">
      <form id="logoutForm" action="/logout" method="POST" class="me-2 mb-0">
        <button class="btn btn-outline-secondary">Logout</button>
      </form>
      <a class="btn btn-outline-primary" href="/">Home</a>
    </div>
  </div>


</nav>


	<!-- Wallet Section -->
<!-- <div class="container ">

  <div class="wallet-container text-center mb-4">
    <div class="wallet-balance fs-4 fw-semibold text-success">
      Wallet Balance: â‚¹ <%= wallet.balance.toFixed(2) %>
    </div>

    <button class="btn btn-success mt-3" data-bs-toggle="modal" data-bs-target="#addMoneyModal">
      Add Money
    </button>
  </div>

  <hr class="my-3">

  <h5 class="fw-semibold text-success mb-3 text-center">ðŸ§¾ Transaction History</h5>

  <% if (wallet.transactions.length === 0) { %>
    <p class="text-muted text-center">No transactions yet.</p>
  <% } else { %>
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-success">
          <tr>
            <th>Transaction ID</th>
            <th>Date</th>
            <th>Amount</th>
            <th>Type</th>
             <th>Status</th> 
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          <% wallet.transactions.slice().reverse().forEach(txn => { %>
            <tr>
              <td><%= txn.transactionId || 'N/A' %></td>
              <td><%= new Date(txn.createdAt).toLocaleDateString() %></td>
              <td class="<%= txn.transactionType === 'Credit' ? 'text-success' : 'text-danger' %>">
                <%= txn.transactionType === 'Credit' ? '+ ' : '- ' %>â‚¹<%= txn.amount.toFixed(2) %>
              </td>
              <td><%= txn.type %></td>
               <td>
                <% if (txn.status === 'completed') { %>
                  <span class="badge bg-success">Completed</span>
                <% } else if (txn.status === 'pending') { %>
                  <span class="badge bg-warning text-dark">Pending</span>
                <% } else { %>
                  <span class="badge bg-danger">Failed</span>
                <% } %>
              </td> 
              <td><%= txn.transactionDetail || '-' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>

  
</div>
<% if (totalPages > 1) { %>
  <nav class="d-flex justify-content-center mt-4">
    <ul class="pagination shadow-sm p-2 rounded-4" style="background-color: #f8f9fa;">

      <% if (currentPage > 1) { %>
        <li class="page-item">
          <a class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-success fw-semibold" 
             href="?page=<%= currentPage - 1 %>" 
             style="background-color: #e9f8ee;">
            â€¹ Prev
          </a>
        </li>
      <% } else { %>
        <li class="page-item disabled">
          <span class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-muted" 
                style="background-color: #f1f1f1;">â€¹ Prev</span>
        </li>
      <% } %>

      <% 
        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, currentPage + 2);
      %>

      <% if (startPage > 1) { %>
        <li class="page-item">
          <a class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-success fw-semibold" 
             href="?page=1" 
             style="background-color: #e9f8ee;">1</a>
        </li>
        <% if (startPage > 2) { %>
          <li class="page-item disabled"><span class="page-link border-0 bg-transparent text-muted">...</span></li>
        <% } %>
      <% } %>

      <% for (let i = startPage; i <= endPage; i++) { %>
        <li class="page-item <%= i === currentPage ? 'active' : '' %>">
          <a class="page-link border-0 rounded-3 mx-1 px-3 py-2 fw-semibold 
                    <%= i === currentPage 
                        ? 'text-white bg-success shadow-sm' 
                        : 'text-success' %>" 
             href="?page=<%= i %>">
            <%= i %>
          </a>
        </li>
      <% } %>

      <% if (endPage < totalPages) { %>
        <% if (endPage < totalPages - 1) { %>
          <li class="page-item disabled"><span class="page-link border-0 bg-transparent text-muted">...</span></li>
        <% } %>
        <li class="page-item">
          <a class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-success fw-semibold" 
             href="?page=<%= totalPages %>" 
             style="background-color: #e9f8ee;"><%= totalPages %></a>
        </li>
      <% } %>

      <% if (currentPage < totalPages) { %>
        <li class="page-item">
          <a class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-success fw-semibold" 
             href="?page=<%= currentPage + 1 %>" 
             style="background-color: #e9f8ee;">
            Next â€º
          </a>
        </li>
      <% } else { %>
        <li class="page-item disabled">
          <span class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-muted" 
                style="background-color: #f1f1f1;">Next â€º</span>
        </li>
      <% } %>

    </ul>
  </nav>
<% } %> -->


<div class="container">

  <div class="wallet-container text-center mb-4">
    <div class="wallet-balance fs-4 fw-semibold text-success">
      Wallet Balance: â‚¹ <%= wallet.balance.toFixed(2) %>
    </div>

    <button class="btn btn-success mt-3" data-bs-toggle="modal" data-bs-target="#addMoneyModal">
      Add Money
    </button>
  </div>

  <hr class="my-3">

  <h5 class="fw-semibold text-success mb-3 text-center">ðŸ§¾ Transaction History</h5>

  <% if (totalTransactions === 0) { %>
    <p class="text-muted text-center">No transactions yet.</p>
  <% } else { %>
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-success">
          <tr>
            <th>Transaction ID</th>
            <th>Date</th>
            <th>Amount</th>
            <th>Type</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          <% transactions.forEach(txn => { %>
            <tr>
              <td><%= txn.transactionId || 'N/A' %></td>
              <td><%= new Date(txn.createdAt).toLocaleString() %></td>
              <td class="<%= txn.transactionType === 'Credit' ? 'text-success' : 'text-danger' %>">
                <%= txn.transactionType === 'Credit' ? '+ ' : '- ' %>â‚¹<%= txn.amount.toFixed(2) %>
              </td>
              <td><%= txn.type %></td>
              <td><%= txn.transactionDetail || '-' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>

  <% if (totalPages > 1) { %>
    <nav class="d-flex justify-content-center mt-4">
      <ul class="pagination shadow-sm p-2 rounded-4" style="background-color: #f8f9fa;">

        <% if (currentPage > 1) { %>
          <li class="page-item">
            <a class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-success fw-semibold" 
               href="?page=<%= currentPage - 1 %>" 
               style="background-color: #e9f8ee;">â€¹ Prev</a>
          </li>
        <% } else { %>
          <li class="page-item disabled">
            <span class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-muted" 
                  style="background-color: #f1f1f1;">â€¹ Prev</span>
          </li>
        <% } %>

        <% 
          const startPage = Math.max(1, currentPage - 2);
          const endPage = Math.min(totalPages, currentPage + 2);
        %>

        <% if (startPage > 1) { %>
          <li class="page-item">
            <a class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-success fw-semibold" 
               href="?page=1" style="background-color: #e9f8ee;">1</a>
          </li>
          <% if (startPage > 2) { %>
            <li class="page-item disabled">
              <span class="page-link border-0 bg-transparent text-muted">...</span>
            </li>
          <% } %>
        <% } %>

        <% for (let i = startPage; i <= endPage; i++) { %>
          <li class="page-item <%= i === currentPage ? 'active' : '' %>">
            <a class="page-link border-0 rounded-3 mx-1 px-3 py-2 fw-semibold 
                      <%= i === currentPage ? 'text-white bg-success shadow-sm' : 'text-success' %>" 
               href="?page=<%= i %>"><%= i %></a>
          </li>
        <% } %>

        <% if (endPage < totalPages) { %>
          <% if (endPage < totalPages - 1) { %>
            <li class="page-item disabled">
              <span class="page-link border-0 bg-transparent text-muted">...</span>
            </li>
          <% } %>
          <li class="page-item">
            <a class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-success fw-semibold" 
               href="?page=<%= totalPages %>" 
               style="background-color: #e9f8ee;"><%= totalPages %></a>
          </li>
        <% } %>

        <% if (currentPage < totalPages) { %>
          <li class="page-item">
            <a class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-success fw-semibold" 
               href="?page=<%= currentPage + 1 %>" 
               style="background-color: #e9f8ee;">Next â€º</a>
          </li>
        <% } else { %>
          <li class="page-item disabled">
            <span class="page-link border-0 rounded-3 mx-1 px-3 py-2 text-muted" 
                  style="background-color: #f1f1f1;">Next â€º</span>
          </li>
        <% } %>

      </ul>
    </nav>
  <% } %>

</div>

	<!-- Modal: Add Money -->
<!-- <div class="modal fade" id="addMoneyModal" tabindex="-1" aria-labelledby="addMoneyModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="addMoneyModalLabel">Add Money to Wallet</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addMoneyForm">
          <div class="mb-3">
            <label for="amount" class="form-label fw-semibold">Enter Amount (â‚¹)</label>
            <input type="number" id="amount" class="form-control" placeholder="Enter amount" min="1" required />
          </div>
          <button type="submit" class="btn btn-success w-100">Proceed to Pay</button>
        </form>
      </div>
    </div>
  </div>
</div> -->


<div class="modal fade" id="addMoneyModal" tabindex="-1" aria-labelledby="addMoneyModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="addMoneyModalLabel">Add Money to Wallet</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="addMoneyForm">
          <div class="mb-3">
            <label for="amount" class="form-label fw-semibold">Enter Amount (â‚¹)</label>
            <input type="number" id="amount" class="form-control" placeholder="Enter amount" min="1" required />
          </div>
          <button type="submit" class="btn btn-success w-100">Proceed to Pay</button>
        </form>
      </div>
    </div>
  </div>
</div>


	<!-- Footer -->
	<footer class="footer">
		<p class="mb-0">Â© 2025 Eanakku Wallet | All Rights Reserved</p>
	</footer>


<script src="https://checkout.razorpay.com/v1/checkout.js"></script>



<script>

  document.getElementById("addMoneyForm").addEventListener("submit", async function (e) {
    e.preventDefault();
    const amount = document.getElementById("amount").value;

    if (!amount || amount <= 0) {
      alert("Please enter a valid amount!");
      return;
    }

    try {
      // 1ï¸âƒ£ Create Razorpay Order (backend)
      const res = await fetch("/wallet/create-order", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ amount }),
      });
      const data = await res.json();
      if (!data.success) return alert("âŒ Failed to create Razorpay order!");

      // 2ï¸âƒ£ Open Razorpay payment window
      const options = {
        key: data.key_id,
        amount: data.amount,
        currency: "INR",
        name: "My Wallet",
        description: "Add Money to Wallet",
        order_id: data.orderId,
        handler: async function (response) {
          // 3ï¸âƒ£ Verify payment on backend
          const verifyRes = await fetch("/wallet/verify", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              ...response,
              amount,
            }),
          });

          const result = await verifyRes.json();
          if (result.success) {
            alert("âœ… Money added to wallet successfully!");
            window.location.reload();
          } else {
            alert("âŒ Payment verification failed!");
          }
        },
        theme: { color: "#198754" },
      };
      const rzp = new Razorpay(options);
      rzp.open();
    } catch (err) {
      console.error("âš ï¸ Error:", err);
      alert("Something went wrong!");
    }
  });










</script>




</body>
</html>